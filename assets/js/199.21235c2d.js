(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{525:function(v,_,t){"use strict";t.r(_);var l=t(7),r=Object(l.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h3",{attrs:{id:"冷备份"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#冷备份"}},[v._v("#")]),v._v(" 冷备份")]),v._v(" "),_("p",[v._v("在《"),_("a",{attrs:{href:"http://c.biancheng.net/view/8136.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("MySQL备份类型"),_("OutboundLink")],1),v._v("》一节介绍过冷备份，冷备份可以称为 Offline Backup（离线备份）。这种备份最为简单，一般只需要复制相关的数据库物理文件到另外的位置即可。")]),v._v(" "),_("p",[v._v("由于 MySQL 服务器中的数据文件是基于磁盘的文本文件，所以最简单、最直接的备份操作，就是将数据文件直接复制出来。但是由于 MySQL 服务器的数据文件在运行时期，总是处于打开和使用状态，因此备份文件不一定有效。为了解决该问题，在复制数据文件时，需要先停止 MySQL 服务器。")]),v._v(" "),_("p",[v._v("这样做的好处是可以保证数据库的完整性，备份过程简单且恢复速度相对快一些，但是关闭数据库会影响现有业务的进行。服务器停止运行期间，用户不能再继续访问网站。例如，一些电商网站店庆促销时，如果为了备份要停库，那么带来的代价损失将不可估量。所以冷备一般用于不是很重要、非核心的业务上面。")]),v._v(" "),_("p",[v._v("冷备份的优点如下：")]),v._v(" "),_("ul",[_("li",[v._v("备份简单、快速，只要复制相关文件即可。")]),v._v(" "),_("li",[v._v("备份文件易于在不同操作系统，不同 MySQL 版本上进行恢复。")]),v._v(" "),_("li",[v._v("恢复相当简单，只需要把文件恢复到指定位置即可。")]),v._v(" "),_("li",[v._v("恢复速度快，不需要执行任何 SQL 语句，也不需要重建索引。")]),v._v(" "),_("li",[v._v("低度维护，高度安全。")])]),v._v(" "),_("p",[v._v("冷备份的缺点如下：")]),v._v(" "),_("ul",[_("li",[v._v("备份过程中，数据库不能做其它的工作，且必须是关闭状态。")]),v._v(" "),_("li",[v._v("InnoDB 存储引擎冷备的文件通常比逻辑文件大很多，因为表空间存放着很多其它的数据，如 undo 段，插入缓冲等信息。")]),v._v(" "),_("li",[v._v("若磁盘空间有限，只能拷贝到磁带等其它外部存储设备上，速度会很慢。")]),v._v(" "),_("li",[v._v("冷备也不总是可以轻易的跨平台。操作系统、MySQL 的版本、文件大小写敏感和浮点数格式都会成为问题。")])]),v._v(" "),_("p",[v._v("数据库的物理文件主要由数据库的数据文件、日志文件以及配置文件等组成。MySQL 系统有一些共有的日志文件和系统表的数据文件。每种存储引擎的物理文件也不一样，不了解的可阅读学习《"),_("a",{attrs:{href:"http://c.biancheng.net/view/vip_8333.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("不同存储引擎的数据表在磁盘里是如何表示的"),_("OutboundLink")],1),v._v("》一节。")]),v._v(" "),_("p",[v._v("冷备的备份与恢复过程也很简单。仅仅需要如下几步：")]),v._v(" "),_("p",[v._v("1）为了保证所备份数据的完整性，在停止 MySQL 数据库服务器之前，需要先执行 FLUSH TABLES 语句将所有数据写入到数据文件的文本文件里。")]),v._v(" "),_("p",[v._v("2）停掉 MySQL 服务，命令（2种方式）如下：")]),v._v(" "),_("ul",[_("li",[v._v("mysqladmin -uroot -proot shutdown")]),v._v(" "),_("li",[v._v("NET START mysql")])]),v._v(" "),_("p",[v._v("3）备份过程就是复制整个数据目录到远程备份机或者本地磁盘上，Linux 和 Windows 命令如下：")]),v._v(" "),_("ul",[_("li",[v._v("Scp -r /data/mysql/ root@远程备份机ip:/新的目录")]),v._v(" "),_("li",[v._v("Copy -r /data/mysql/ 本地新目录")])]),v._v(" "),_("p",[v._v("备份到本次磁盘也可以手动复制上述相关目录里的数据文件。")]),v._v(" "),_("p",[v._v("4）恢复过程就更简单了，仅仅需要把已备份的数据目录替换原有的目录就可以了，最后重启 MySQL 服务。")]),v._v(" "),_("blockquote",[_("p",[v._v("恢复数据是数据库维护中最常用的操作，利用备份文件可以将 MySQL 数据库服务器恢复到备份时的状态，这样就可以将管理员的非常操作和计算机的故障造成的相关损失降到最小。")])]),v._v(" "),_("p",[v._v("上面我们介绍了如何通过数据文件实现数据备份和恢复。需要注意的是，通过复制数据文件这种方式实现数据恢复时，必须保证两个 MySQL 数据库的主版本号一致。只有两个 MySQL 数据库主版本号相同时，才能保证它们的数据文件类型是相同的。")]),v._v(" "),_("h4",{attrs:{id:"关于-mysql-数据库服务器的版本号"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#关于-mysql-数据库服务器的版本号"}},[v._v("#")]),v._v(" 关于 MySQL 数据库服务器的版本号")]),v._v(" "),_("p",[v._v("第一个数字表示主版本号，例如 MySQL 5.5.21 和 MySQL 5.5.01 这两个版本的主版本号都是 5，所以这两个数据库拥有相同类型的数据文件。")])])}),[],!1,null,null,null);_.default=r.exports}}]);