(window.webpackJsonp=window.webpackJsonp||[]).push([[211],{537:function(e,a,n){"use strict";n.r(a);var r=n(7),_=Object(r.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"mysql通用查询日志-general-query-log"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql通用查询日志-general-query-log"}},[e._v("#")]),e._v(" MySQL通用查询日志（General Query Log）")]),e._v(" "),a("p",[e._v("通用查询日志（General Query Log）用来记录用户的所有操作，包括启动和关闭 MySQL 服务、更新语句和查询语句等。")]),e._v(" "),a("p",[e._v("默认情况下，通用查询日志功能是关闭的。可以通过以下命令查看通用查询日志是否开启，命令如下：")]),e._v(" "),a("p",[e._v("mysql> SHOW VARIABLES LIKE '%general%';\n+------------------+----------------------------------------------------------------+\n| Variable_name    | Value                                                          |\n+------------------+----------------------------------------------------------------+\n| general_log      | OFF                                                            |\n| general_log_file | C:\\ProgramData\\MySQL\\MySQL Server 5.7\\Data\\LAPTOP-UHQ6V8KP.log |\n+------------------+----------------------------------------------------------------+\n2 rows in set, 1 warning (0.01 sec)")]),e._v(" "),a("p",[e._v("从结果可以看出，通用查询日志是关闭的，general_log_file 变量指定了通用查询日志文件所在的位置。")]),e._v(" "),a("h2",{attrs:{id:"启动和设置通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动和设置通用查询日志"}},[e._v("#")]),e._v(" 启动和设置通用查询日志")]),e._v(" "),a("p",[e._v("在 MySQL 中，可以通过在 MySQL 配置文件添加 log 选项来开启通用查询日志，格式如下：")]),e._v(" "),a("p",[e._v("[mysqld]"),a("br"),e._v("\nlog=dir/filename")]),e._v(" "),a("p",[e._v("其中，dir 参数指定通用查询日志的存储路径；filename 参数指定日志的文件名。如果不指定存储路径，通用查询日志将默认存储到 MySQL 数据库的数据文件夹下。如果不指定文件名，默认文件名为 hostname.log，其中 hostname 表示主机名。")]),e._v(" "),a("h2",{attrs:{id:"查看通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看通用查询日志"}},[e._v("#")]),e._v(" 查看通用查询日志")]),e._v(" "),a("p",[e._v("如果希望了解用户最近的操作，可以查看通用查询日志。通用查询日志以文本文件的形式存储，可以使用普通文本文件查看该类型日志内容。")]),e._v(" "),a("h4",{attrs:{id:"例-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例-1"}},[e._v("#")]),e._v(" 例 1")]),e._v(" "),a("p",[e._v("首先我们查看通用查询日志功能是否是开启状态，然后查询 tb_student 表的记录，SQL 命令和执行过程如下：")]),e._v(" "),a("p",[e._v("mysql> SHOW VARIABLES LIKE '%general%';\n+------------------+----------------------------------------------------------------+\n| Variable_name    | Value                                                          |\n+------------------+----------------------------------------------------------------+\n| general_log      | ON                                                             |\n| general_log_file | C:\\ProgramData\\MySQL\\MySQL Server 5.7\\Data\\LAPTOP-UHQ6V8KP.log |\n+------------------+----------------------------------------------------------------+\n2 rows in set, 1 warning (0.02 sec)")]),e._v(" "),a("p",[e._v("mysql> use test;\nDatabase changed\nmysql> SELECT * FROM tb_student;\n+----+--------+\n| id | name   |\n+----+--------+\n|  1 | Java   |\n|  2 | MySQL  |\n|  3 | Python |\n+----+--------+\n3 rows in set (0.06 sec)")]),e._v(" "),a("p",[e._v("执行成功后，打开通用查询日志，这里日志名称为 LAPTOP-UHQ6V8KP.log，下面是通用查询日志中的部分内容。")]),e._v(" "),a("p",[e._v("C:\\Program Files\\MySQL\\MySQL Server 5.7\\bin\\mysqld.exe, Version: 5.7.29-log (MySQL Community Server (GPL)). started with:"),a("br"),e._v("\nTCP Port: 3306, Named Pipe: MySQL"),a("br"),e._v("\nTime                 Id Command    Argument"),a("br"),e._v("\n2020-05-29T06:43:44.382878Z     7 Quit"),a("br"),e._v("\n2020-05-29T06:44:10.001382Z     8 Connect root@localhost on  using SSL/TLS"),a("br"),e._v("\n2020-05-29T06:44:10.007532Z     8 Query select @@version_comment limit 1"),a("br"),e._v("\n2020-05-29T06:44:11.748179Z     8 Query SHOW VARIABLES LIKE '%general%'"),a("br"),e._v("\n2020-05-29T06:44:25.487472Z     8 Query SELECT DATABASE()"),a("br"),e._v("\n2020-05-29T06:44:25.487748Z     8 Init DB test"),a("br"),e._v("\n2020-05-29T06:44:35.390523Z     8 Query SELECT * FROM tb_student")]),e._v(" "),a("p",[e._v("可以看出，该日志非常清晰地记录了客户端的所有行为。")]),e._v(" "),a("h2",{attrs:{id:"停止通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止通用查询日志"}},[e._v("#")]),e._v(" 停止通用查询日志")]),e._v(" "),a("p",[e._v("通用查询日志启动后，可以通过两种方法停止该日志。一种是将 MySQL 配置文件中的相关配置注释掉，然后重启服务器，来停止通用查询日志。具体内容如下：")]),e._v(" "),a("p",[e._v("[mysqld]"),a("br"),e._v("\n#log=dir\\filename")]),e._v(" "),a("p",[e._v("上述方法需要重启 MySQL 服务器，这在某些场景，比如有业务量访问的情况下是不允许的，这时可以通过另一种方法来动态地控制通用查询日志的开启和关闭。")]),e._v(" "),a("p",[e._v("设置 MySQL 的环境变量 general_log 为关闭状态可以停止该日志，示例如下：")]),e._v(" "),a("p",[e._v("mysql> SET GLOBAL general_log=off;\nQuery OK, 0 rows affected (0.00 sec)")]),e._v(" "),a("p",[e._v("mysql> SHOW VARIABLES LIKE '%general_log%' \\G\n*************************** 1. row ***************************\nVariable_name: general_log\nValue: OFF\n*************************** 2. row ***************************\nVariable_name: general_log_file\nValue: C:\\ProgramData\\MySQL\\MySQL Server 5.7\\Data\\LAPTOP-UHQ6V8KP.log\n2 rows in set, 1 warning (0.01 sec)")]),e._v(" "),a("h2",{attrs:{id:"删除通用查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除通用查询日志"}},[e._v("#")]),e._v(" 删除通用查询日志")]),e._v(" "),a("p",[e._v("在 MySQL 中，可以使用 mysqladmin 命令来开启新的通用查询日志。新的通用查询日志会直接覆盖旧的查询日志，不需要再手动删除了。")]),e._v(" "),a("p",[e._v("mysqladmin 命令的语法如下：")]),e._v(" "),a("p",[e._v("mysqladmin -uroot -p flush-logs")]),e._v(" "),a("p",[e._v("需要注意的是，如果希望备份旧的通用查询日志，必须先将旧的日志文件拷贝出来或者改名。然后，再执行 mysqladmin 命令。")]),e._v(" "),a("p",[e._v("除了上述方法之外，还可以手工删除通用查询日志。删除之后需要重新启动 MySQL 服务。重启之后就会生成新的通用查询日志。如果希望备份旧的日志文件，可以将旧的日志文件改名，然后重启 MySQL 服务。")]),e._v(" "),a("p",[e._v("由于通用查询日志会记录用户的所有操作，如果数据库的使用非常频繁，通用查询日志将会占用非常大的磁盘空间，对系统性能影响较大。一般情况下，数据管理员可以删除很长时间之前的通用查询日志或关闭此日志，以保证 MySQL 服务器上的硬盘空间。")])])}),[],!1,null,null,null);a.default=_.exports}}]);