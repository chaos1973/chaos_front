(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{407:function(n,t,e){"use strict";e.r(t);var a=e(7),s=Object(a.a)({},(function(){var n=this,t=n._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h4",{attrs:{id:"countdownlatch的理解和使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#countdownlatch的理解和使用"}},[n._v("#")]),n._v(" CountDownLatch的理解和使用")]),n._v(" "),t("p",[n._v("原文链接："),t("a",{attrs:{href:"https://www.cnblogs.com/Lee_xy_z/p/10470181.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("CountDownLatch的理解和使用 - Shane_Li - 博客园 (cnblogs.com)"),t("OutboundLink")],1)]),n._v(" "),t("p",[t("strong",[n._v("CountDownLatch概念")])]),n._v(" "),t("p",[n._v("CountDownLatch是一个同步工具类，用来协调多个线程之间的同步，或者说起到线程之间的通信（而不是用作互斥的作用）。")]),n._v(" "),t("p",[n._v("CountDownLatch能够使一个线程在等待另外一些线程完成各自工作之后，再继续执行。使用一个计数器进行实现。计数器初始值为线程的数量。当每一个线程完成自己任务后，计数器的值就会减一。当计数器的值为0时，表示所有的线程都已经完成一些任务，然后在CountDownLatch上等待的线程就可以恢复执行接下来的任务。")]),n._v(" "),t("p",[t("strong",[n._v("CountDownLatch的用法")])]),n._v(" "),t("p",[n._v("CountDownLatch典型用法：1、某一线程在开始运行前等待n个线程执行完毕。将CountDownLatch的计数器初始化为new CountDownLatch(n)，每当一个任务线程执行完毕，就将计数器减1 countdownLatch.countDown()，当计数器的值变为0时，在CountDownLatch上await()的线程就会被唤醒。一个典型应用场景就是启动一个服务时，主线程需要等待多个组件加载完毕，之后再继续执行。")]),n._v(" "),t("p",[n._v("CountDownLatch典型用法：2、实现多个线程开始执行任务的最大并行性。注意是并行性，不是并发，强调的是多个线程在某一时刻同时开始执行。类似于赛跑，将多个线程放到起点，等待发令枪响，然后同时开跑。做法是初始化一个共享的CountDownLatch(1)，将其计算器初始化为1，多个线程在开始执行任务前首先countdownlatch.await()，当主线程调用countDown()时，计数器变为0，多个线程同时被唤醒。")]),n._v(" "),t("p",[t("strong",[n._v("CountDownLatch的不足")])]),n._v(" "),t("p",[n._v("CountDownLatch是一次性的，计算器的值只能在构造方法中初始化一次，之后没有任何机制再次对其设置值，当CountDownLatch使用完毕后，它不能再次被使用。")]),n._v(" "),t("p",[t("strong",[n._v("CountDownLatch（倒计时计算器）使用说明")])]),n._v(" "),t("p",[n._v("方法说明")]),n._v(" "),t("p",[n._v("public void countDown()")]),n._v(" "),t("p",[n._v("递减锁存器的计数，如果计数到达零，则释放所有等待的线程。如果当前计数大于零，则将计数减少.")]),n._v(" "),t("p",[n._v("public boolean await(long timeout,TimeUnit unit) throws InterruptedException")]),n._v(" "),t("p",[n._v("使当前线程在锁存器倒计数至零之前一直等待，除非线程被中断或超出了指定的等待时间。如果当前计数为零，则此方法立刻返回true值。")]),n._v(" "),t("p",[n._v("如果当前计数大于零，则出于线程调度目的，将禁用当前线程，且在发生以下三种情况之一前，该线程将一直出于休眠状态：")]),n._v(" "),t("p",[n._v("由于调用countDown()方法，计数到达零；或者其他某个线程中断当前线程；或者已超出指定的等待时间。")]),n._v(" "),t("ul",[t("li",[n._v("如果计数到达零，则该方法返回true值。")]),n._v(" "),t("li",[n._v("如果当前线程，在进入此方法时已经设置了该线程的中断状态；或者在等待时被中断，则抛出InterruptedException，并且清除当前线程的已中断状态。")]),n._v(" "),t("li",[n._v("如果超出了指定的等待时间，则返回值为false。如果该时间小于等于零，则该方法根本不会等待。")])]),n._v(" "),t("p",[n._v("参数：")]),n._v(" "),t("p",[n._v("timeout-要等待的最长时间")]),n._v(" "),t("p",[n._v("unit-timeout 参数的时间单位")]),n._v(" "),t("p",[n._v("返回：")]),n._v(" "),t("p",[n._v("如果计数到达零，则返回true；如果在计数到达零之前超过了等待时间，则返回false")]),n._v(" "),t("p",[n._v("抛出：")]),n._v(" "),t("p",[n._v("InterruptedException-如果当前线程在等待时被中断")]),n._v(" "),t("p",[n._v("例子1：")]),n._v(" "),t("p",[n._v("主线程等待子线程执行完成在执行")]),n._v(" "),t("p",[n._v("["),t("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),n._v("](javascript:void(0)😉")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('package com.example.demo.CountDownLatchDemo;\n\nimport java.util.concurrent.CountDownLatch;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\n/**\n * 主线程等待子线程执行完成再执行\n */\npublic class CountdownLatchTest1 {\n    public static void main(String[] args) {\n        ExecutorService service = Executors.newFixedThreadPool(3);\n        final CountDownLatch latch = new CountDownLatch(3);\n        for (int i = 0; i < 3; i++) {\n            Runnable runnable = new Runnable() {\n                @Override\n                public void run() {\n                    try {\n                        System.out.println("子线程" + Thread.currentThread().getName() + "开始执行");\n                        Thread.sleep((long) (Math.random() * 10000));\n                        System.out.println("子线程"+Thread.currentThread().getName()+"执行完成");\n                        latch.countDown();//当前线程调用此方法，则计数减一\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            };\n            service.execute(runnable);\n        }\n\n        try {\n            System.out.println("主线程"+Thread.currentThread().getName()+"等待子线程执行完成...");\n            latch.await();//阻塞当前线程，直到计数器的值为0\n            System.out.println("主线程"+Thread.currentThread().getName()+"开始执行...");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br")])]),t("p",[n._v("["),t("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),n._v("](javascript:void(0)😉")]),n._v(" "),t("p",[n._v("例子2：")]),n._v(" "),t("p",[n._v("百米赛跑，4名运动员选手到达场地等待裁判口令，裁判一声口令，选手听到后同时起跑，当所有选手到达终点，裁判进行汇总排名")]),n._v(" "),t("p",[n._v("["),t("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),n._v("](javascript:void(0)😉")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('package com.example.demo.CountDownLatchDemo;\n\nimport java.util.concurrent.CountDownLatch;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class CountdownLatchTest2 {\n    public static void main(String[] args) {\n        ExecutorService service = Executors.newCachedThreadPool();\n        final CountDownLatch cdOrder = new CountDownLatch(1);\n        final CountDownLatch cdAnswer = new CountDownLatch(4);\n        for (int i = 0; i < 4; i++) {\n            Runnable runnable = new Runnable() {\n                @Override\n                public void run() {\n                    try {\n                        System.out.println("选手" + Thread.currentThread().getName() + "正在等待裁判发布口令");\n                        cdOrder.await();\n                        System.out.println("选手" + Thread.currentThread().getName() + "已接受裁判口令");\n                        Thread.sleep((long) (Math.random() * 10000));\n                        System.out.println("选手" + Thread.currentThread().getName() + "到达终点");\n                        cdAnswer.countDown();\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            };\n            service.execute(runnable);\n        }\n        try {\n            Thread.sleep((long) (Math.random() * 10000));\n            System.out.println("裁判"+Thread.currentThread().getName()+"即将发布口令");\n            cdOrder.countDown();\n            System.out.println("裁判"+Thread.currentThread().getName()+"已发送口令，正在等待所有选手到达终点");\n            cdAnswer.await();\n            System.out.println("所有选手都到达终点");\n            System.out.println("裁判"+Thread.currentThread().getName()+"汇总成绩排名");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        service.shutdown();\n    }\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br")])]),t("p",[n._v("["),t("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"复制代码"}}),n._v("](javascript:void(0)😉")]),n._v(" "),t("p",[n._v("原文链接： https://blog.csdn.net/joenqc/article/details/76794356")]),n._v(" "),t("p",[n._v("https://www.cnblogs.com/tstd/p/4987935.html")]),n._v(" "),t("p",[n._v("分类: "),t("a",{attrs:{href:"https://www.cnblogs.com/Lee_xy_z/category/1336814.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("Java"),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("[好文要顶](javascript:void(0)😉 [关注我](javascript:void(0)😉 [收藏该文](javascript:void(0)😉 ["),t("img",{attrs:{src:"https://common.cnblogs.com/images/icon_weibo_24.png",alt:"img"}}),n._v("](javascript:void(0)😉 ["),t("img",{attrs:{src:"https://common.cnblogs.com/images/wechat.png",alt:"img"}}),n._v("](javascript:void(0)😉")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://home.cnblogs.com/u/Lee_xy_z/",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://pic.cnblogs.com/face/sample_face.gif",alt:"img"}}),t("OutboundLink")],1)]),n._v(" "),t("p",[t("a",{attrs:{href:"https://home.cnblogs.com/u/Lee_xy_z/",target:"_blank",rel:"noopener noreferrer"}},[n._v("Shane_Li"),t("OutboundLink")],1),n._v(" "),t("a",{attrs:{href:"https://home.cnblogs.com/u/Lee_xy_z/followers/",target:"_blank",rel:"noopener noreferrer"}},[n._v("粉丝 - 9"),t("OutboundLink")],1),n._v(" "),t("a",{attrs:{href:"https://home.cnblogs.com/u/Lee_xy_z/followees/",target:"_blank",rel:"noopener noreferrer"}},[n._v("关注 - 12"),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("[+加关注](javascript:void(0)😉")]),n._v(" "),t("p",[n._v("20")]),n._v(" "),t("p",[n._v("3")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/Lee_xy_z/p/10466674.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("» "),t("OutboundLink")],1),n._v("下一篇： "),t("a",{attrs:{href:"https://www.cnblogs.com/Lee_xy_z/p/10466674.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("架构设计：系统间通信（1）--概述从“聊天”开始上篇"),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("posted @ 2019-03-04 15:54 "),t("a",{attrs:{href:"https://www.cnblogs.com/Lee_xy_z/",target:"_blank",rel:"noopener noreferrer"}},[n._v("Shane_Li"),t("OutboundLink")],1),n._v(" 阅读(176699) 评论(8) "),t("a",{attrs:{href:"https://i.cnblogs.com/EditPosts.aspx?postid=10470181",target:"_blank",rel:"noopener noreferrer"}},[n._v("编辑"),t("OutboundLink")],1),n._v(" [收藏](javascript:void(0)) [举报](javascript:void(0))")])])}),[],!1,null,null,null);t.default=s.exports}}]);