<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第37章【高级篇】补充：MyCat | Chao&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/chaos_front/img/favicon.ico">
    <meta name="description" content="技术博客,专注各种技术学习与总结。前端、后端、数据库、运维等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/chaos_front/assets/css/0.styles.e07996ee.css" as="style"><link rel="preload" href="/chaos_front/assets/js/app.a5a7dd88.js" as="script"><link rel="preload" href="/chaos_front/assets/js/3.f64bc0e7.js" as="script"><link rel="preload" href="/chaos_front/assets/js/2.733f61f4.js" as="script"><link rel="preload" href="/chaos_front/assets/js/191.cf629e1b.js" as="script"><link rel="prefetch" href="/chaos_front/assets/js/1.10eff7f6.js"><link rel="prefetch" href="/chaos_front/assets/js/10.755587d4.js"><link rel="prefetch" href="/chaos_front/assets/js/100.1d84541b.js"><link rel="prefetch" href="/chaos_front/assets/js/101.a811741c.js"><link rel="prefetch" href="/chaos_front/assets/js/102.eb284fb9.js"><link rel="prefetch" href="/chaos_front/assets/js/103.cc314987.js"><link rel="prefetch" href="/chaos_front/assets/js/104.347d4752.js"><link rel="prefetch" href="/chaos_front/assets/js/105.87b9a905.js"><link rel="prefetch" href="/chaos_front/assets/js/106.0b67ab93.js"><link rel="prefetch" href="/chaos_front/assets/js/107.0112e5f0.js"><link rel="prefetch" href="/chaos_front/assets/js/108.ca253486.js"><link rel="prefetch" href="/chaos_front/assets/js/109.163cb6ae.js"><link rel="prefetch" href="/chaos_front/assets/js/11.ca0874b6.js"><link rel="prefetch" href="/chaos_front/assets/js/110.caff0456.js"><link rel="prefetch" href="/chaos_front/assets/js/111.33600461.js"><link rel="prefetch" href="/chaos_front/assets/js/112.3b1b546e.js"><link rel="prefetch" href="/chaos_front/assets/js/113.da5ad3d1.js"><link rel="prefetch" href="/chaos_front/assets/js/114.dfd512eb.js"><link rel="prefetch" href="/chaos_front/assets/js/115.a77e3ad1.js"><link rel="prefetch" href="/chaos_front/assets/js/116.1dd67fe2.js"><link rel="prefetch" href="/chaos_front/assets/js/117.b1856f06.js"><link rel="prefetch" href="/chaos_front/assets/js/118.3b81a966.js"><link rel="prefetch" href="/chaos_front/assets/js/119.bc811882.js"><link rel="prefetch" href="/chaos_front/assets/js/12.adcfd85b.js"><link rel="prefetch" href="/chaos_front/assets/js/120.ba24bccd.js"><link rel="prefetch" href="/chaos_front/assets/js/121.f7e4b2ba.js"><link rel="prefetch" href="/chaos_front/assets/js/122.6d4faf65.js"><link rel="prefetch" href="/chaos_front/assets/js/123.a221ea00.js"><link rel="prefetch" href="/chaos_front/assets/js/124.07746247.js"><link rel="prefetch" href="/chaos_front/assets/js/125.66d545fd.js"><link rel="prefetch" href="/chaos_front/assets/js/126.5b19f2e1.js"><link rel="prefetch" href="/chaos_front/assets/js/127.23f07bbb.js"><link rel="prefetch" href="/chaos_front/assets/js/128.3a4819ef.js"><link rel="prefetch" href="/chaos_front/assets/js/129.0a172042.js"><link rel="prefetch" href="/chaos_front/assets/js/13.b8ed82ef.js"><link rel="prefetch" href="/chaos_front/assets/js/130.47643c75.js"><link rel="prefetch" href="/chaos_front/assets/js/131.c06051e8.js"><link rel="prefetch" href="/chaos_front/assets/js/132.e154cdcd.js"><link rel="prefetch" href="/chaos_front/assets/js/133.10ac3ba3.js"><link rel="prefetch" href="/chaos_front/assets/js/134.4ea14ea7.js"><link rel="prefetch" href="/chaos_front/assets/js/135.ce84c9a1.js"><link rel="prefetch" href="/chaos_front/assets/js/136.38381699.js"><link rel="prefetch" href="/chaos_front/assets/js/137.ff1a5be0.js"><link rel="prefetch" href="/chaos_front/assets/js/138.402b5519.js"><link rel="prefetch" href="/chaos_front/assets/js/139.6876359c.js"><link rel="prefetch" href="/chaos_front/assets/js/14.11294ada.js"><link rel="prefetch" href="/chaos_front/assets/js/140.f27c9472.js"><link rel="prefetch" href="/chaos_front/assets/js/141.d985ab42.js"><link rel="prefetch" href="/chaos_front/assets/js/142.6b44a10c.js"><link rel="prefetch" href="/chaos_front/assets/js/143.599444f7.js"><link rel="prefetch" href="/chaos_front/assets/js/144.9905689b.js"><link rel="prefetch" href="/chaos_front/assets/js/145.fff8bd8a.js"><link rel="prefetch" href="/chaos_front/assets/js/146.32eff525.js"><link rel="prefetch" href="/chaos_front/assets/js/147.936ac75c.js"><link rel="prefetch" href="/chaos_front/assets/js/148.e560869e.js"><link rel="prefetch" href="/chaos_front/assets/js/149.ca25cc9e.js"><link rel="prefetch" href="/chaos_front/assets/js/15.53363e77.js"><link rel="prefetch" href="/chaos_front/assets/js/150.cf33d2ac.js"><link rel="prefetch" href="/chaos_front/assets/js/151.c18d240a.js"><link rel="prefetch" href="/chaos_front/assets/js/152.5a724a58.js"><link rel="prefetch" href="/chaos_front/assets/js/153.4b502e96.js"><link rel="prefetch" href="/chaos_front/assets/js/154.17fab615.js"><link rel="prefetch" href="/chaos_front/assets/js/155.069daf47.js"><link rel="prefetch" href="/chaos_front/assets/js/156.31bb4575.js"><link rel="prefetch" href="/chaos_front/assets/js/157.264a9650.js"><link rel="prefetch" href="/chaos_front/assets/js/158.2ca32ebb.js"><link rel="prefetch" href="/chaos_front/assets/js/159.482bb8f7.js"><link rel="prefetch" href="/chaos_front/assets/js/16.c67a6382.js"><link rel="prefetch" href="/chaos_front/assets/js/160.400e41e9.js"><link rel="prefetch" href="/chaos_front/assets/js/161.60739569.js"><link rel="prefetch" href="/chaos_front/assets/js/162.e207cefe.js"><link rel="prefetch" href="/chaos_front/assets/js/163.f3ad0f85.js"><link rel="prefetch" href="/chaos_front/assets/js/164.2d903696.js"><link rel="prefetch" href="/chaos_front/assets/js/165.f3e314db.js"><link rel="prefetch" href="/chaos_front/assets/js/166.290c3f8d.js"><link rel="prefetch" href="/chaos_front/assets/js/167.b51f2e93.js"><link rel="prefetch" href="/chaos_front/assets/js/168.43a20db8.js"><link rel="prefetch" href="/chaos_front/assets/js/169.c35bb684.js"><link rel="prefetch" href="/chaos_front/assets/js/17.9c3dca11.js"><link rel="prefetch" href="/chaos_front/assets/js/170.8a51b98c.js"><link rel="prefetch" href="/chaos_front/assets/js/171.fcd06b15.js"><link rel="prefetch" href="/chaos_front/assets/js/172.7f84c7b5.js"><link rel="prefetch" href="/chaos_front/assets/js/173.18d04166.js"><link rel="prefetch" href="/chaos_front/assets/js/174.80678279.js"><link rel="prefetch" href="/chaos_front/assets/js/175.11f35221.js"><link rel="prefetch" href="/chaos_front/assets/js/176.125e654a.js"><link rel="prefetch" href="/chaos_front/assets/js/177.8d043a97.js"><link rel="prefetch" href="/chaos_front/assets/js/178.7b0ac817.js"><link rel="prefetch" href="/chaos_front/assets/js/179.507835c6.js"><link rel="prefetch" href="/chaos_front/assets/js/18.01b8ee33.js"><link rel="prefetch" href="/chaos_front/assets/js/180.8f7b772b.js"><link rel="prefetch" href="/chaos_front/assets/js/181.b56f4b5c.js"><link rel="prefetch" href="/chaos_front/assets/js/182.5fbb3b15.js"><link rel="prefetch" href="/chaos_front/assets/js/183.c817e17d.js"><link rel="prefetch" href="/chaos_front/assets/js/184.21511817.js"><link rel="prefetch" href="/chaos_front/assets/js/185.6cdcac68.js"><link rel="prefetch" href="/chaos_front/assets/js/186.656ffb24.js"><link rel="prefetch" href="/chaos_front/assets/js/187.47728e71.js"><link rel="prefetch" href="/chaos_front/assets/js/188.9a9e72e1.js"><link rel="prefetch" href="/chaos_front/assets/js/189.2432946b.js"><link rel="prefetch" href="/chaos_front/assets/js/19.d667f50c.js"><link rel="prefetch" href="/chaos_front/assets/js/190.74c1eaf9.js"><link rel="prefetch" href="/chaos_front/assets/js/192.b9bd8bd3.js"><link rel="prefetch" href="/chaos_front/assets/js/193.7281be63.js"><link rel="prefetch" href="/chaos_front/assets/js/194.8d7d8c42.js"><link rel="prefetch" href="/chaos_front/assets/js/195.44358180.js"><link rel="prefetch" href="/chaos_front/assets/js/196.eb9837d8.js"><link rel="prefetch" href="/chaos_front/assets/js/197.22d585f0.js"><link rel="prefetch" href="/chaos_front/assets/js/198.a1e75f17.js"><link rel="prefetch" href="/chaos_front/assets/js/199.21235c2d.js"><link rel="prefetch" href="/chaos_front/assets/js/20.d1d11745.js"><link rel="prefetch" href="/chaos_front/assets/js/200.4b150617.js"><link rel="prefetch" href="/chaos_front/assets/js/201.16bfbf46.js"><link rel="prefetch" href="/chaos_front/assets/js/202.0f8ce4bc.js"><link rel="prefetch" href="/chaos_front/assets/js/203.b190cb7b.js"><link rel="prefetch" href="/chaos_front/assets/js/204.7f86de91.js"><link rel="prefetch" href="/chaos_front/assets/js/205.742adee4.js"><link rel="prefetch" href="/chaos_front/assets/js/206.77d6c652.js"><link rel="prefetch" href="/chaos_front/assets/js/207.4675c40e.js"><link rel="prefetch" href="/chaos_front/assets/js/208.1bb890bb.js"><link rel="prefetch" href="/chaos_front/assets/js/209.0fdbe43c.js"><link rel="prefetch" href="/chaos_front/assets/js/21.2a4eecf1.js"><link rel="prefetch" href="/chaos_front/assets/js/210.2fe2ff6b.js"><link rel="prefetch" href="/chaos_front/assets/js/211.0fe0c320.js"><link rel="prefetch" href="/chaos_front/assets/js/212.4fc502e7.js"><link rel="prefetch" href="/chaos_front/assets/js/213.b58a7fa2.js"><link rel="prefetch" href="/chaos_front/assets/js/214.c4f60846.js"><link rel="prefetch" href="/chaos_front/assets/js/215.6de96810.js"><link rel="prefetch" href="/chaos_front/assets/js/216.8c7e5e3c.js"><link rel="prefetch" href="/chaos_front/assets/js/217.c0f3cb53.js"><link rel="prefetch" href="/chaos_front/assets/js/218.421e18c0.js"><link rel="prefetch" href="/chaos_front/assets/js/219.d5d212a7.js"><link rel="prefetch" href="/chaos_front/assets/js/22.9527eb39.js"><link rel="prefetch" href="/chaos_front/assets/js/220.50609852.js"><link rel="prefetch" href="/chaos_front/assets/js/221.dd498e76.js"><link rel="prefetch" href="/chaos_front/assets/js/222.11bd3fa2.js"><link rel="prefetch" href="/chaos_front/assets/js/223.8bc9ca65.js"><link rel="prefetch" href="/chaos_front/assets/js/224.99e1279c.js"><link rel="prefetch" href="/chaos_front/assets/js/225.1a9a4687.js"><link rel="prefetch" href="/chaos_front/assets/js/226.2011ce40.js"><link rel="prefetch" href="/chaos_front/assets/js/227.4fbd6c1a.js"><link rel="prefetch" href="/chaos_front/assets/js/228.ed6dbf22.js"><link rel="prefetch" href="/chaos_front/assets/js/229.5a2b57b8.js"><link rel="prefetch" href="/chaos_front/assets/js/23.8594b63b.js"><link rel="prefetch" href="/chaos_front/assets/js/230.87155b2e.js"><link rel="prefetch" href="/chaos_front/assets/js/231.35301101.js"><link rel="prefetch" href="/chaos_front/assets/js/232.be2812ea.js"><link rel="prefetch" href="/chaos_front/assets/js/233.d2629449.js"><link rel="prefetch" href="/chaos_front/assets/js/234.00f57e7f.js"><link rel="prefetch" href="/chaos_front/assets/js/235.f8770e56.js"><link rel="prefetch" href="/chaos_front/assets/js/236.8fe7ca12.js"><link rel="prefetch" href="/chaos_front/assets/js/237.ceb87f60.js"><link rel="prefetch" href="/chaos_front/assets/js/238.4b9e9847.js"><link rel="prefetch" href="/chaos_front/assets/js/239.bbf3154c.js"><link rel="prefetch" href="/chaos_front/assets/js/24.7b9655b4.js"><link rel="prefetch" href="/chaos_front/assets/js/240.c36dab39.js"><link rel="prefetch" href="/chaos_front/assets/js/241.2030daf6.js"><link rel="prefetch" href="/chaos_front/assets/js/242.ab187a3b.js"><link rel="prefetch" href="/chaos_front/assets/js/243.cd96548c.js"><link rel="prefetch" href="/chaos_front/assets/js/244.8ac75ef3.js"><link rel="prefetch" href="/chaos_front/assets/js/245.31062447.js"><link rel="prefetch" href="/chaos_front/assets/js/246.bf7950ce.js"><link rel="prefetch" href="/chaos_front/assets/js/247.06297bcb.js"><link rel="prefetch" href="/chaos_front/assets/js/248.6e535448.js"><link rel="prefetch" href="/chaos_front/assets/js/249.c397dbb9.js"><link rel="prefetch" href="/chaos_front/assets/js/25.89db4503.js"><link rel="prefetch" href="/chaos_front/assets/js/250.29dbbd92.js"><link rel="prefetch" href="/chaos_front/assets/js/251.4ef7b586.js"><link rel="prefetch" href="/chaos_front/assets/js/252.86e42bc4.js"><link rel="prefetch" href="/chaos_front/assets/js/253.6b0dd325.js"><link rel="prefetch" href="/chaos_front/assets/js/254.f989a26b.js"><link rel="prefetch" href="/chaos_front/assets/js/255.767e261a.js"><link rel="prefetch" href="/chaos_front/assets/js/256.4237a9a7.js"><link rel="prefetch" href="/chaos_front/assets/js/257.8ad5a8cf.js"><link rel="prefetch" href="/chaos_front/assets/js/258.32603cb5.js"><link rel="prefetch" href="/chaos_front/assets/js/259.af5e4c2e.js"><link rel="prefetch" href="/chaos_front/assets/js/26.532f31ae.js"><link rel="prefetch" href="/chaos_front/assets/js/260.60969904.js"><link rel="prefetch" href="/chaos_front/assets/js/261.7e780660.js"><link rel="prefetch" href="/chaos_front/assets/js/262.9e3ef425.js"><link rel="prefetch" href="/chaos_front/assets/js/263.28ac9cc7.js"><link rel="prefetch" href="/chaos_front/assets/js/264.67a5a83b.js"><link rel="prefetch" href="/chaos_front/assets/js/265.9568f6b1.js"><link rel="prefetch" href="/chaos_front/assets/js/266.d1e6a15d.js"><link rel="prefetch" href="/chaos_front/assets/js/267.85c81bfc.js"><link rel="prefetch" href="/chaos_front/assets/js/268.7096108a.js"><link rel="prefetch" href="/chaos_front/assets/js/269.6c6657dd.js"><link rel="prefetch" href="/chaos_front/assets/js/27.74758f4d.js"><link rel="prefetch" href="/chaos_front/assets/js/270.a37abd59.js"><link rel="prefetch" href="/chaos_front/assets/js/271.caf82cb2.js"><link rel="prefetch" href="/chaos_front/assets/js/272.8f1807a7.js"><link rel="prefetch" href="/chaos_front/assets/js/273.9a8e3d8e.js"><link rel="prefetch" href="/chaos_front/assets/js/274.48587d8a.js"><link rel="prefetch" href="/chaos_front/assets/js/275.9abe526f.js"><link rel="prefetch" href="/chaos_front/assets/js/276.3010345f.js"><link rel="prefetch" href="/chaos_front/assets/js/277.1faecedc.js"><link rel="prefetch" href="/chaos_front/assets/js/278.6fac1539.js"><link rel="prefetch" href="/chaos_front/assets/js/279.a33b0d2d.js"><link rel="prefetch" href="/chaos_front/assets/js/28.a669efa7.js"><link rel="prefetch" href="/chaos_front/assets/js/280.2f31d9d1.js"><link rel="prefetch" href="/chaos_front/assets/js/281.69596739.js"><link rel="prefetch" href="/chaos_front/assets/js/282.eeb80f12.js"><link rel="prefetch" href="/chaos_front/assets/js/283.ad2f2384.js"><link rel="prefetch" href="/chaos_front/assets/js/284.26962ed9.js"><link rel="prefetch" href="/chaos_front/assets/js/285.0ce6a4a6.js"><link rel="prefetch" href="/chaos_front/assets/js/286.809fde55.js"><link rel="prefetch" href="/chaos_front/assets/js/287.9f081096.js"><link rel="prefetch" href="/chaos_front/assets/js/288.6446a5ce.js"><link rel="prefetch" href="/chaos_front/assets/js/289.5d64cdf0.js"><link rel="prefetch" href="/chaos_front/assets/js/29.121e5fdf.js"><link rel="prefetch" href="/chaos_front/assets/js/290.24b89995.js"><link rel="prefetch" href="/chaos_front/assets/js/291.6915bc7b.js"><link rel="prefetch" href="/chaos_front/assets/js/292.bfaffd03.js"><link rel="prefetch" href="/chaos_front/assets/js/293.0c7e2712.js"><link rel="prefetch" href="/chaos_front/assets/js/294.52bfdfcb.js"><link rel="prefetch" href="/chaos_front/assets/js/295.f5940e8f.js"><link rel="prefetch" href="/chaos_front/assets/js/296.4f84f06a.js"><link rel="prefetch" href="/chaos_front/assets/js/297.4e17e7c8.js"><link rel="prefetch" href="/chaos_front/assets/js/298.514a7f85.js"><link rel="prefetch" href="/chaos_front/assets/js/299.8674d457.js"><link rel="prefetch" href="/chaos_front/assets/js/30.87aacca4.js"><link rel="prefetch" href="/chaos_front/assets/js/300.3d17d9aa.js"><link rel="prefetch" href="/chaos_front/assets/js/301.4ee47578.js"><link rel="prefetch" href="/chaos_front/assets/js/302.d7907b2a.js"><link rel="prefetch" href="/chaos_front/assets/js/303.7d9bb126.js"><link rel="prefetch" href="/chaos_front/assets/js/304.b0590a86.js"><link rel="prefetch" href="/chaos_front/assets/js/31.85ad0891.js"><link rel="prefetch" href="/chaos_front/assets/js/32.5b3890d5.js"><link rel="prefetch" href="/chaos_front/assets/js/33.04ff7d40.js"><link rel="prefetch" href="/chaos_front/assets/js/34.3e868d61.js"><link rel="prefetch" href="/chaos_front/assets/js/35.8b4f7217.js"><link rel="prefetch" href="/chaos_front/assets/js/36.67cfd791.js"><link rel="prefetch" href="/chaos_front/assets/js/37.a6c8c03d.js"><link rel="prefetch" href="/chaos_front/assets/js/38.522e7754.js"><link rel="prefetch" href="/chaos_front/assets/js/39.86bdb02d.js"><link rel="prefetch" href="/chaos_front/assets/js/4.a57f9af6.js"><link rel="prefetch" href="/chaos_front/assets/js/40.c4ee11cc.js"><link rel="prefetch" href="/chaos_front/assets/js/41.61599656.js"><link rel="prefetch" href="/chaos_front/assets/js/42.3886b215.js"><link rel="prefetch" href="/chaos_front/assets/js/43.b5c1ee51.js"><link rel="prefetch" href="/chaos_front/assets/js/44.8278a9f9.js"><link rel="prefetch" href="/chaos_front/assets/js/45.2f65a2ec.js"><link rel="prefetch" href="/chaos_front/assets/js/46.163aca75.js"><link rel="prefetch" href="/chaos_front/assets/js/47.8467c80b.js"><link rel="prefetch" href="/chaos_front/assets/js/48.4c5c756f.js"><link rel="prefetch" href="/chaos_front/assets/js/49.354827a9.js"><link rel="prefetch" href="/chaos_front/assets/js/5.aa4775fd.js"><link rel="prefetch" href="/chaos_front/assets/js/50.d0bc3af2.js"><link rel="prefetch" href="/chaos_front/assets/js/51.a5ff85c3.js"><link rel="prefetch" href="/chaos_front/assets/js/52.ccb411e2.js"><link rel="prefetch" href="/chaos_front/assets/js/53.3d23f142.js"><link rel="prefetch" href="/chaos_front/assets/js/54.9ce310f5.js"><link rel="prefetch" href="/chaos_front/assets/js/55.75b6a986.js"><link rel="prefetch" href="/chaos_front/assets/js/56.b4254c72.js"><link rel="prefetch" href="/chaos_front/assets/js/57.925ed1b7.js"><link rel="prefetch" href="/chaos_front/assets/js/58.0a2a148a.js"><link rel="prefetch" href="/chaos_front/assets/js/59.4c5ab5c2.js"><link rel="prefetch" href="/chaos_front/assets/js/6.8d375b42.js"><link rel="prefetch" href="/chaos_front/assets/js/60.83b71091.js"><link rel="prefetch" href="/chaos_front/assets/js/61.e4530a5e.js"><link rel="prefetch" href="/chaos_front/assets/js/62.689f005c.js"><link rel="prefetch" href="/chaos_front/assets/js/63.99b8895b.js"><link rel="prefetch" href="/chaos_front/assets/js/64.47813aa9.js"><link rel="prefetch" href="/chaos_front/assets/js/65.8bd24915.js"><link rel="prefetch" href="/chaos_front/assets/js/66.822a92d6.js"><link rel="prefetch" href="/chaos_front/assets/js/67.9425ccaa.js"><link rel="prefetch" href="/chaos_front/assets/js/68.10747161.js"><link rel="prefetch" href="/chaos_front/assets/js/69.e40da584.js"><link rel="prefetch" href="/chaos_front/assets/js/70.1c5aa1ff.js"><link rel="prefetch" href="/chaos_front/assets/js/71.fe67b441.js"><link rel="prefetch" href="/chaos_front/assets/js/72.fb85692d.js"><link rel="prefetch" href="/chaos_front/assets/js/73.0854b0d0.js"><link rel="prefetch" href="/chaos_front/assets/js/74.4725b5c6.js"><link rel="prefetch" href="/chaos_front/assets/js/75.f4f3a6c4.js"><link rel="prefetch" href="/chaos_front/assets/js/76.184c7f81.js"><link rel="prefetch" href="/chaos_front/assets/js/77.2ab5cf8a.js"><link rel="prefetch" href="/chaos_front/assets/js/78.50642b32.js"><link rel="prefetch" href="/chaos_front/assets/js/79.10dee2cc.js"><link rel="prefetch" href="/chaos_front/assets/js/80.351310c0.js"><link rel="prefetch" href="/chaos_front/assets/js/81.c75947c2.js"><link rel="prefetch" href="/chaos_front/assets/js/82.e70175c6.js"><link rel="prefetch" href="/chaos_front/assets/js/83.f9fba32a.js"><link rel="prefetch" href="/chaos_front/assets/js/84.2880afc3.js"><link rel="prefetch" href="/chaos_front/assets/js/85.656f8c91.js"><link rel="prefetch" href="/chaos_front/assets/js/86.064a9f6c.js"><link rel="prefetch" href="/chaos_front/assets/js/87.7e064b36.js"><link rel="prefetch" href="/chaos_front/assets/js/88.ec8a2461.js"><link rel="prefetch" href="/chaos_front/assets/js/89.ee3705ac.js"><link rel="prefetch" href="/chaos_front/assets/js/9.2ff9c0d6.js"><link rel="prefetch" href="/chaos_front/assets/js/90.951c2a9e.js"><link rel="prefetch" href="/chaos_front/assets/js/91.ee5139a1.js"><link rel="prefetch" href="/chaos_front/assets/js/92.357468f6.js"><link rel="prefetch" href="/chaos_front/assets/js/93.01f44531.js"><link rel="prefetch" href="/chaos_front/assets/js/94.15903fed.js"><link rel="prefetch" href="/chaos_front/assets/js/95.053fcb00.js"><link rel="prefetch" href="/chaos_front/assets/js/96.e96762eb.js"><link rel="prefetch" href="/chaos_front/assets/js/97.f60da6b2.js"><link rel="prefetch" href="/chaos_front/assets/js/98.5df77349.js"><link rel="prefetch" href="/chaos_front/assets/js/99.cd428d44.js"><link rel="prefetch" href="/chaos_front/assets/js/vendors~docsearch.6101ed53.js">
    <link rel="stylesheet" href="/chaos_front/assets/css/0.styles.e07996ee.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/chaos_front/" class="home-link router-link-active"><img src="/chaos_front/img/logo.png" alt="Chao's Blog" class="logo"> <span class="site-name can-hide">Chao's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/chaos_front/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/chaos_front/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chaos_front/pages/0b717a/" class="nav-link">vue路由</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chaos_front/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/chaos_front/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/chaos_front/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/chaos_front/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/1b141f/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/b2111e/" class="nav-link">spring</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/0244f5/" class="nav-link">springboot</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/1dbe25/" class="nav-link">springcloud</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/f6a255/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/877b76/" class="nav-link">maven</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/affc9b/" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/dcd5c4/" class="nav-link">tomcat</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/436747/" class="nav-link">springmvc</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/ce613a/" class="nav-link">jvm</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/chaos_front/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/0a3455/" class="nav-link">图数据库</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/7d831e/" class="nav-link">mysql数据库</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/1528fa/" class="nav-link">redis数据库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docker&amp;K8s" class="dropdown-title"><a href="/chaos_front/docker/" class="link-title">Docker&amp;K8s</a> <span class="title" style="display:none;">Docker&amp;K8s</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/c12f09/" class="nav-link">windows下docker安装nginx并挂载目录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><a href="/chaos_front/linux/" class="link-title">Linux</a> <span class="title" style="display:none;">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/271e21/" class="nav-link">linux命令</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/e66dd1/" class="nav-link">linux安装软件</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/78c56a/" class="nav-link">linux脚本</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/chaos_front/tools/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/c36f84/" class="nav-link">idea</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/tags/" class="nav-link">vscode</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/chaos_front/pro/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>综合项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chaos_front/pages/f709a2/" class="nav-link">若依项目</a></li><li class="dropdown-subitem"><a href="/chaos_front/pages/f43ed6/" class="nav-link">mall项目</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/chaos_front/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/9430be/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/4a4b44/" class="nav-link">mybatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件技术" class="dropdown-title"><a href="/chaos_front/component/" class="link-title">组件技术</a> <span class="title" style="display:none;">组件技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/024f8e/" class="nav-link">xxl-job</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/4a4b44/" class="nav-link">mybatis</a></li></ul></div></div> <a href="https://github.com/chaos1973/chaos_front" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/chaos_front/img/micro_head.png"> <div class="blogger-info"><h3>~chao</h3> <span>永远菜鸟,不断努力~</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/chaos_front/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/chaos_front/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chaos_front/pages/0b717a/" class="nav-link">vue路由</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chaos_front/note/javascript/" class="nav-link">《JavaScript教程》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/js/" class="nav-link">《JavaScript高级程序设计》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/es6/" class="nav-link">《ES6 教程》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/vue/" class="nav-link">《Vue》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/react/" class="nav-link">《React》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/typescript-axios/" class="nav-link">《TypeScript 从零实现 axios》</a></li><li class="dropdown-subitem"><a href="/chaos_front/note/git/" class="nav-link">《Git》</a></li><li class="dropdown-subitem"><a href="/chaos_front/pages/51afd6/" class="nav-link">TypeScript</a></li><li class="dropdown-subitem"><a href="/chaos_front/pages/4643cd/" class="nav-link">JS设计模式总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/chaos_front/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/1b141f/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/b2111e/" class="nav-link">spring</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/0244f5/" class="nav-link">springboot</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/1dbe25/" class="nav-link">springcloud</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/f6a255/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/877b76/" class="nav-link">maven</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/affc9b/" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/dcd5c4/" class="nav-link">tomcat</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/436747/" class="nav-link">springmvc</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/ce613a/" class="nav-link">jvm</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/chaos_front/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/0a3455/" class="nav-link">图数据库</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/7d831e/" class="nav-link">mysql数据库</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/1528fa/" class="nav-link">redis数据库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docker&amp;K8s" class="dropdown-title"><a href="/chaos_front/docker/" class="link-title">Docker&amp;K8s</a> <span class="title" style="display:none;">Docker&amp;K8s</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/c12f09/" class="nav-link">windows下docker安装nginx并挂载目录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><a href="/chaos_front/linux/" class="link-title">Linux</a> <span class="title" style="display:none;">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/271e21/" class="nav-link">linux命令</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/e66dd1/" class="nav-link">linux安装软件</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/78c56a/" class="nav-link">linux脚本</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/chaos_front/tools/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/c36f84/" class="nav-link">idea</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/tags/" class="nav-link">vscode</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/chaos_front/pro/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>综合项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/chaos_front/pages/f709a2/" class="nav-link">若依项目</a></li><li class="dropdown-subitem"><a href="/chaos_front/pages/f43ed6/" class="nav-link">mall项目</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/chaos_front/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/9430be/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/4a4b44/" class="nav-link">mybatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件技术" class="dropdown-title"><a href="/chaos_front/component/" class="link-title">组件技术</a> <span class="title" style="display:none;">组件技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/chaos_front/pages/024f8e/" class="nav-link">xxl-job</a></li><li class="dropdown-item"><!----> <a href="/chaos_front/pages/4a4b44/" class="nav-link">mybatis</a></li></ul></div></div> <a href="https://github.com/chaos1973/chaos_front" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>cypher图数据</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>mysql数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>mysql尚硅谷宋红康</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/chaos_front/pages/3b443c/" class="sidebar-link">第00章_写在前面</a></li><li><a href="/chaos_front/pages/7d831e/" class="sidebar-link">第01章_数据库概述</a></li><li><a href="/chaos_front/pages/33a1ab/" class="sidebar-link">第02章_MySQL环境搭建</a></li><li><a href="/chaos_front/pages/eb1f0c/" class="sidebar-link">第03章_基本的SELECT语句</a></li><li><a href="/chaos_front/pages/a98fc2/" class="sidebar-link">第04章_运算符</a></li><li><a href="/chaos_front/pages/54106a/" class="sidebar-link">第05章_排序与分页</a></li><li><a href="/chaos_front/pages/11f44e/" class="sidebar-link">第06章_多表查询</a></li><li><a href="/chaos_front/pages/d353b4/" class="sidebar-link">第07章_单行函数</a></li><li><a href="/chaos_front/pages/84fe30/" class="sidebar-link">第08章_聚合函数</a></li><li><a href="/chaos_front/pages/f0d734/" class="sidebar-link">第09章_子查询</a></li><li><a href="/chaos_front/pages/cfcb5b/" class="sidebar-link">第10章_创建和管理表</a></li><li><a href="/chaos_front/pages/35839e/" class="sidebar-link">第11章_数据处理之增删改</a></li><li><a href="/chaos_front/pages/c7e8ee/" class="sidebar-link">第12章_MySQL数据类型精讲</a></li><li><a href="/chaos_front/pages/2a8f1c/" class="sidebar-link">第13章_约束</a></li><li><a href="/chaos_front/pages/fe8501/" class="sidebar-link">第14章_视图</a></li><li><a href="/chaos_front/pages/da14a6/" class="sidebar-link">第15章_存储过程与函数</a></li><li><a href="/chaos_front/pages/1ecf53/" class="sidebar-link">第16章_变量、流程控制与游标</a></li><li><a href="/chaos_front/pages/ffbabb/" class="sidebar-link">第17章_触发器</a></li><li><a href="/chaos_front/pages/f9f074/" class="sidebar-link">第18章_MySQL8其它新特性</a></li><li><a href="/chaos_front/pages/a066ad/" class="sidebar-link">第19章【高级篇】MySQL的数据目录</a></li><li><a href="/chaos_front/pages/963350/" class="sidebar-link">第20章【高级篇】用户、权限、角色管理</a></li><li><a href="/chaos_front/pages/ff707a/" class="sidebar-link">第21章【高级篇】MySQL密码管理、配置文件的使用、系统变量</a></li><li><a href="/chaos_front/pages/cf9130/" class="sidebar-link">第22章【高级篇】MySQL的逻辑架构</a></li><li><a href="/chaos_front/pages/3f29f4/" class="sidebar-link">第23章【高级篇】MySQL的存储引擎</a></li><li><a href="/chaos_front/pages/f1fa6d/" class="sidebar-link">第24章【高级篇】索引的数据结构</a></li><li><a href="/chaos_front/pages/23a597/" class="sidebar-link">第25章【高级篇】InnoDB的数据存储结构</a></li><li><a href="/chaos_front/pages/a4b23f/" class="sidebar-link">第26章【高级篇】索引的创建与删除</a></li><li><a href="/chaos_front/pages/0cb6a3/" class="sidebar-link">第27章【高级篇】索引的设计原则</a></li><li><a href="/chaos_front/pages/eda0ce/" class="sidebar-link">第28章【高级篇】性能分析工具的使用</a></li><li><a href="/chaos_front/pages/1d050f/" class="sidebar-link">第29章【高级篇】索引优化与查询优化</a></li><li><a href="/chaos_front/pages/6d5e08/" class="sidebar-link">第30章【高级篇】数据库的设计规范</a></li><li><a href="/chaos_front/pages/7fe01d/" class="sidebar-link">第31章【高级篇】数据库其它调优策略</a></li><li><a href="/chaos_front/pages/dcbd40/" class="sidebar-link">第32章【高级篇】事务基础知识</a></li><li><a href="/chaos_front/pages/f42d20/" class="sidebar-link">第33章【高级篇】MySQL事务日志</a></li><li><a href="/chaos_front/pages/50f277/" class="sidebar-link">第34章【高级篇】锁</a></li><li><a href="/chaos_front/pages/add3f1/" class="sidebar-link">第35章【高级篇】多版本并发控制MVCC</a></li><li><a href="/chaos_front/pages/53f720/" class="sidebar-link">第36章【高级篇】其他数据库日志</a></li><li><a href="/chaos_front/pages/7a58d7/" aria-current="page" class="active sidebar-link">第37章【高级篇】补充：MyCat</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_1-mycat概述" class="sidebar-link">1\. Mycat概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_1-1-基本介绍" class="sidebar-link">1.1 基本介绍</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_1-2-mycat作用" class="sidebar-link">1.2 Mycat作用</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_1-3-原理" class="sidebar-link">1.3 原理</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_2-使用前准备工作" class="sidebar-link">2\. 使用前准备工作</a></li><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_3-安装启动" class="sidebar-link">3\. 安装启动</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_3-1-安装" class="sidebar-link">3.1 安装</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_3-2-配置与启动" class="sidebar-link">3.2 配置与启动</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_3-3-登录" class="sidebar-link">3.3 登录</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1-登录后台管理窗口" class="sidebar-link">1\. 登录后台管理窗口</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2-登录数据窗口" class="sidebar-link">2\. 登录数据窗口</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_3-项目中登录" class="sidebar-link">3\. 项目中登录</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_4-主从复制原理" class="sidebar-link">4\. 主从复制原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_4-1-主从复制原理" class="sidebar-link">4.1 主从复制原理</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_4-2-mysql复制三步骤" class="sidebar-link">4.2 MySQL复制三步骤：</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_4-3-复制的问题" class="sidebar-link">4.3 复制的问题</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_4-4-复制的基本原则" class="sidebar-link">4.4 复制的基本原则</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_5-主从复制与读写分离的实现" class="sidebar-link">5\. 主从复制与读写分离的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_5-1-搭建主从复制-一主一从" class="sidebar-link">5.1 搭建主从复制：一主一从</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1、搭建mysql主从复制" class="sidebar-link">1、搭建MySQL主从复制</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2、mycat登录访问" class="sidebar-link">2、Mycat登录访问</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_5-2-实现一主一从的读写分离" class="sidebar-link">5.2 实现一主一从的读写分离</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1、验证读写分离" class="sidebar-link">1、验证读写分离</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2、实现读写分离" class="sidebar-link">2、实现读写分离</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_3、启动mycat" class="sidebar-link">3、启动Mycat</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_4、验证读写分离" class="sidebar-link">4、验证读写分离</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_5-3-搭建主从复制-双主双从" class="sidebar-link">5.3 搭建主从复制：双主双从</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1、储备" class="sidebar-link">1、储备</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2、-搭建mysql主从复制-双主双从" class="sidebar-link">2、 搭建MySQL主从复制（双主双从）</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_5-4-实现双主双从机的读写分离" class="sidebar-link">5.4 实现双主双从机的读写分离</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1、修改配置文件" class="sidebar-link">1、修改配置文件</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2、启动mycat" class="sidebar-link">2、启动Mycat</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_3、验证读写分离" class="sidebar-link">3、验证读写分离</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_4、抗风险能力测试" class="sidebar-link">4、抗风险能力测试</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_6-mycat数据分片" class="sidebar-link">6\. Mycat数据分片</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_6-1-什么是数据分片" class="sidebar-link">6.1 什么是数据分片？</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_6-2-切分模式" class="sidebar-link">6.2 切分模式</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_6-3-mycat分片原理" class="sidebar-link">6.3 Mycat分片原理</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_7-垂直拆分-分库" class="sidebar-link">7\. 垂直拆分——分库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_7-1-如何划分表" class="sidebar-link">7.1 如何划分表</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_7-2-实现分库" class="sidebar-link">7.2 实现分库</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1、修改schema配置文件" class="sidebar-link">1、修改schema配置文件</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2、新增两个空白库" class="sidebar-link">2、新增两个空白库</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_3、启动mycat-2" class="sidebar-link">3、启动Mycat</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_4、访问mycat进行分库" class="sidebar-link">4、访问Mycat进行分库</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/chaos_front/pages/7a58d7/#_8-水平拆分-分表" class="sidebar-link">8\. 水平拆分——分表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_8-1-实现分表" class="sidebar-link">8.1 实现分表</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1、选择要拆分的表" class="sidebar-link">1、选择要拆分的表</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2、分表字段的考量" class="sidebar-link">2、分表字段的考量</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_3、修改配置文件schema-xml" class="sidebar-link">3、修改配置文件schema.xml</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_4、-修改配置文件rule-xml" class="sidebar-link">4、 修改配置文件rule.xml</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_5、在数据节点dn2上建orders表" class="sidebar-link">5、在数据节点dn2上建orders表</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_6、重启mycat让配置生效" class="sidebar-link">6、重启Mycat让配置生效</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_7、访问mycat实现分片" class="sidebar-link">7、访问Mycat实现分片</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_8-2-mycat-的分片-join" class="sidebar-link">8.2 Mycat 的分片 “join”</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_1、er表" class="sidebar-link">1、ER表</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#_2、全局表" class="sidebar-link">2、全局表</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_8-3-常用分片规则" class="sidebar-link">8.3 常用分片规则</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式1-取模" class="sidebar-link">方式1：取模</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式2-分片枚举" class="sidebar-link">方式2：分片枚举</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式3-范围约定" class="sidebar-link">方式3：范围约定</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式4-按日期-天-分片" class="sidebar-link">方式4：按日期（天）分片</a></li><li class="sidebar-sub-header level3"><a href="/chaos_front/pages/7a58d7/#_8-4-全局id序列" class="sidebar-link">8.4 全局ID序列</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式1-本地文件-不推荐" class="sidebar-link">方式1：本地文件（不推荐）</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式2-数据库方式-推荐" class="sidebar-link">方式2：数据库方式（推荐）</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式3-时间戳方式-不推荐" class="sidebar-link">方式3：时间戳方式（不推荐）</a></li><li class="sidebar-sub-header level4"><a href="/chaos_front/pages/7a58d7/#方式4-自主生成全局序列" class="sidebar-link">方式4：自主生成全局序列</a></li></ul></li></ul></li><li><a href="/chaos_front/pages/33ce2a/" class="sidebar-link">第38章【高级篇】主从复制</a></li><li><a href="/chaos_front/pages/25a958/" class="sidebar-link">第39章【高级篇】数据库备份与恢复</a></li><li><a href="/chaos_front/pages/12e380/" class="sidebar-link">第00章_写在最后</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>总结</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>mysql数据库备份与恢复</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>mysql日志</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>mysql性能优化</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>oracle数据库</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/chaos_front/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/chaos_front/categories/?category=%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-06225672>数据库</a></li><li data-v-06225672><a href="/chaos_front/categories/?category=mysql%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-06225672>mysql数据库</a></li><li data-v-06225672><a href="/chaos_front/categories/?category=mysql%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%AE%8B%E7%BA%A2%E5%BA%B7" title="分类" data-v-06225672>mysql尚硅谷宋红康</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/chaos1973/chaos_front" target="_blank" title="作者" class="beLink" data-v-06225672>~chao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-12-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">第37章【高级篇】补充：MyCat<!----></h1>  <div class="theme-vdoing-content content__default"><h3 id="【宋红康-mysql数据库-】【高级篇】补充-mycat"><a href="#【宋红康-mysql数据库-】【高级篇】补充-mycat" class="header-anchor">#</a> 【宋红康 MySQL数据库 】【高级篇】补充：MyCat</h3> <h2 id="_1-mycat概述"><a href="#_1-mycat概述" class="header-anchor">#</a> 1. Mycat概述</h2> <p>如今随着互联网的发展，数据的量级也是成指数的增长，从 GB 到 TB 到 PB。对数据的各种操作也是愈加的困难，传统的关系性数据库已经无法满足快速查询与插入数据的需求。这个时候 NoSQL 的出现暂时解决了这一危机。它通过降低数据的安全性，减少对事务的支持，减少对复杂查询的支持，来获取性能上的提升。</p> <p>但是，在有些场合 NoSQL 一些折中是无法满足使用场景的，就比如有些使用场景是绝对要有事务与安全指标的。这个时候 NoSQL 肯定是无法满足的，所以还是需要使用关系性数据库。如何使用关系型数据库解决海量存储的问题呢？此时就需要做数据库集群，为了提高查询性能将一个数据库的数据分散到不同的数据库中存储。</p> <h3 id="_1-1-基本介绍"><a href="#_1-1-基本介绍" class="header-anchor">#</a> 1.1 基本介绍</h3> <p>Mycat是<code>数据库分库分表</code>中间件。</p> <p><img src="https://img-blog.csdnimg.cn/ab8326d14d5445149b36ff15d9641bce.png" alt="在这里插入图片描述"></p> <p><strong>1、数据库中间件</strong></p> <p><strong>中间件：是一类连接软件组件和应用的计算机软件，以便于软件各部件之间的沟通</strong>。</p> <p>例子：Tomcat，web中间件。</p> <p>数据库中间件：连接java应用程序和数据库</p> <p><strong>2、为什么要用Mycat？</strong></p> <p>① Java与数据库紧耦合。万一耦合的MySQL DBMS挂了怎么办？</p> <p>② 高访问量、高并发对数据库的压力。</p> <p>③ 多个数据库读写请求数据不一致</p> <p><strong>3、数据库中间件对比</strong></p> <p><img src="https://img-blog.csdnimg.cn/d3cddb7274fc490394beed57b31eb52d.png" alt="在这里插入图片描述"></p> <p>① <code>Cobar</code>属于阿里B2B事业群，始于2008年，在阿里服役3年多，接管3000+个My<a href="https://so.csdn.net/so/search?q=SQL%E6%95%B0%E6%8D%AE%E5%BA%93&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">SQL数据库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的schema,集群日处理在线SQL请求50亿次以上。由于Cobar发起人的离职，Cobar停止维护。</p> <p>② <code>Mycat</code>是开源社区在阿里cobar基础上进行二次开发，解决了cobar存在的问题，并且加入了许多新的功能在其中。青出于蓝而胜于蓝。</p> <p>③ <code>OneProxy</code>基于MySQL官方的proxy思想利用c语言进行开发的，OneProxy是一款商业<code>收费</code>的中间件。舍弃了一些功能，专注在<code>性能和稳定性上</code>。</p> <p>④ <code>kingshard</code>由小团队用go语言开发，还需要发展，需要不断完善。</p> <p>⑤ <code>Vitess</code>是Youtube生产在使用，架构很复杂。不支持MySQL原生协议，使用<code>需要大量改造成本</code>。</p> <p>⑥ <code>Atlas</code>是360团队基于mysql proxy改写，功能还需完善，高并发下不稳定。</p> <p>⑦ <code>MaxScale</code>是mariadb（MySQL原作者维护的一个版本） 研发的中间件</p> <p>⑧ <code>MySQLRoute</code>是MySQL官方Oracle公司发布的中间件</p> <p><img src="https://img-blog.csdnimg.cn/49791fe62518483c9977abc9d35cc926.png" alt="在这里插入图片描述"></p> <h3 id="_1-2-mycat作用"><a href="#_1-2-mycat作用" class="header-anchor">#</a> 1.2 Mycat作用</h3> <p><strong>1、读写分离</strong></p> <p><img src="https://img-blog.csdnimg.cn/d7332113cf6e49dcbc8bdc24d2b1910c.png" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/dcad921c1b774c8a853f140af2f361ea.png" alt="在这里插入图片描述"></p> <p><strong>2、数据分片</strong></p> <p>垂直拆分（分库）、水平拆分（分表）、垂直+水平拆分（分库分表）</p> <p><img src="https://img-blog.csdnimg.cn/5a0165b1fd36471f821b08a5f98ef6ce.png" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/51dbfff148504fffb44b966b542ae2d3.png" alt="在这里插入图片描述"></p> <p><strong>3、多数据源整合</strong></p> <p><img src="https://img-blog.csdnimg.cn/397a85b38d7246b8a75437e542cc47be.png" alt="在这里插入图片描述"></p> <p>Mycat支持的数据库：</p> <p><img src="https://img-blog.csdnimg.cn/8da4157d164340d9a7f83db121574e34.png" alt="在这里插入图片描述"></p> <h3 id="_1-3-原理"><a href="#_1-3-原理" class="header-anchor">#</a> 1.3 原理</h3> <p>Mycat 的原理中最重要的一个动词是“<code>拦截</code>”，它拦截了用户发送过来的 SQL 语句，首先对 SQL 语句做了一些特定的分析：如<code>分片分析、路由分析、读写分离分析、缓存分析</code>等，然后将此 SQL 发往后端的真实数据库，并将返回的结果做适当的处理，最终再返回给用户。</p> <p><img src="https://img-blog.csdnimg.cn/a3bf4a8459734ca8aeb4434c1520abe7.png" alt="在这里插入图片描述"></p> <p>这种方式把数据库的分布式从代码中解耦出来，程序员察觉不出来后台使用<code>Mycat</code>还是<code>MySQL</code>。</p> <p>整体过程可以概括为：<code>拦截</code> – <code>分发</code> – <code>响应</code></p> <h2 id="_2-使用前准备工作"><a href="#_2-使用前准备工作" class="header-anchor">#</a> 2. 使用前准备工作</h2> <p>1、准备<code>4台</code>CentOS 虚拟机</p> <p>2、每台虚拟机上需要安装好MySQL (可以是MySQL8.0 或者 MySQL5.7 皆可)</p> <p>说明：前面我们讲过如何克隆一台CentOS。大家可以在一台CentOS上安装好MySQL，进而通过克隆的方式复制出3台包含MySQL的虚拟机。</p> <p>注意：克隆的方式需要修改新克隆出来主机的：① <code>MAC地址</code> ② <code>hostname</code> ③ <code>IP 地址</code> ④ <code>UUID</code>。</p> <p>此外，克隆的方式生成的虚拟机（包含MySQL Server），则克隆的虚拟机MySQL Server的UUID相同，必须修改，否则在有些场景会报错。比如：<code>show slave status\G</code>，报如下的错误：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Last_IO_Error: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改MySQL Server 的UUID方式：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim /var/lib/mysql/auto.cnf

systemctl restart mysqld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_3-安装启动"><a href="#_3-安装启动" class="header-anchor">#</a> 3. 安装启动</h2> <h3 id="_3-1-安装"><a href="#_3-1-安装" class="header-anchor">#</a> 3.1 安装</h3> <p><strong>1、解压后即可使用</strong></p> <p><img src="https://img-blog.csdnimg.cn/6bd2c4ca820842f5b8ffc08b190d85f6.png" alt="在这里插入图片描述"></p> <p>解压缩文件拷贝到linux下 <code>/usr/local/</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@atguigu02 opt]# tar -zxvf Mycat-server-1.6.7.1-release-20190627191042-linux.tar.gz

[root@atguigu02 opt]# cp -r mycat/ /usr/local

[root@atguigu02 opt]# rm -rf mycat

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/97180accb8e948da880adf2e3fdb6714.png" alt="在这里插入图片描述"></p> <p>打开mycat目录结构如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bin：二进制执行文件
conf：配置文件目录
lib：依赖
logs：日志
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>2、conf目录下三个配置文件</strong></p> <p><img src="https://img-blog.csdnimg.cn/87ecd4e2d6c94e5fb99c1ef66b7ef169.png" alt="在这里插入图片描述"></p> <p>① <code>schema.xml</code>：定义逻辑库，表、分片节点等内容，实现读写分离</p> <p>② <code>rule.xml</code>：定义分片规则，实现分库分表规则配置</p> <p>③ <code>server.xml</code>：配置MyCat作为虚拟数据库的信息（地址、数据库名、用户名、密码等信息）</p> <h3 id="_3-2-配置与启动"><a href="#_3-2-配置与启动" class="header-anchor">#</a> 3.2 配置与启动</h3> <p><strong>1、修改配置文件 server.xml</strong></p> <p>修改用户信息，与MySQL区分，如下：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 这里的TESTDB，理解为用户面向Mycat的统一的一个逻辑数据库。--&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/6d3cbc72c9ed4d2d8242ff18ae202579.png" alt="在这里插入图片描述"></p> <p><strong>2、修改配置文件 schema.xml</strong></p> <ul><li><p>删除<code>&lt;schema&gt;</code>标签间的表信息，增加dataNode属性 <code>dataNode=&quot;dn1&quot;</code></p></li> <li><p><code>&lt;dataNode&gt;</code>标签只留一个，可修改属性值</p></li> <li><p><code>&lt;dataHost&gt;</code>标签只留一个，修改属性值</p></li> <li><p>内部节点<code>&lt;writeHost&gt;</code> 和 <code>&lt;readHost&gt;</code>只留一对，修改属性值：url、user、password</p></li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mycat:schema</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;schema.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mycat:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>mycat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://io.mycat/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 虚拟库与真实库的映射 
	name=&quot;TESTDB&quot; 虚拟库的名字，对应刚刚在server.xml中设置的TESTDB
	sqlMaxLimit=&quot;100&quot;，允许最大查询记录数
	checkSQLschema=&quot;false&quot; 是否检查自动删除 “虚拟库名”
	dataNode=&quot;dn1&quot; 虚拟库对应的真实database，值为dataNode标签的name
	--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TESTDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 可以访问的表，只有设置在这里的表才会被MyCat管理访问 
		dataNode:虚拟库对应的真实database，对应&lt;dataNode&gt;标签。如果做分片，则配置多个，用逗号分隔；或者使用db$0-99，代表db0到db99的database
		rule：分片规则，如果没有则删除
		--&gt;</span>
		<span class="token comment">&lt;!-- &lt;table name=&quot;tb_item&quot; dataNode=&quot;dn1&quot;/&gt; --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
	
	<span class="token comment">&lt;!-- 真实的database信息，每一个dataNode就是一个数据库分片
		name：虚拟名称
		dataHost：真实库的主机信息，对应&lt;dataHost&gt;标签
		database：真实MySQL中真实的物理数据库名称
	--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testdb<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	
	<span class="token comment">&lt;!-- 真实库的主机信息
		name：主机名,name属性值要与dataNode节点中的dataHost属性值对应
		maxCon：最大连接， minCon：最小连接
		balance：负载均衡方式：0~3四种选项。0，不开启读写分离。1~3都开启，区别是主是否参与读
		writeType：写负载均衡。永远设置0
		dbDriver：驱动类型，推荐native，可选jdbc
		switchType：主从的自动切换
	--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 这里设置写主机信息 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

			<span class="token comment">&lt;!-- 这里设置读主机信息 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.127:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
	
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mycat:</span>schema</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/b765e0d22bbc45259858a7e5bbddbc11.jpeg" alt="在这里插入图片描述"></p> <p><strong>3、验证数据库访问情况</strong></p> <p>Mycat作为数据库中间件要和数据库部署在不同机器上，所以要验证远程访问情况。使用Mycat所在的主机访问Master和Slave端的MySQL Server。</p> <p>注意：要关闭防火墙！</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#确认两台MySQL服务器可以通过远程进行访问
mysql -uroot -p123123 -h 192.168.140.128 -P 3306
mysql -uroot -p123123 -h 192.168.140.127 -P 3306

#如远程访问报错，请建对应用户
grant all privileges on *.* to root@'缺少的host'  identified by '123123';

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>4、启动程序</strong></p> <p>在 <code>mycat/bin</code> 目录下执行：</p> <p><strong>方式1：控制台启动</strong> ： <code>./mycat console</code></p> <p><strong>方式2：后台启动</strong> ： <code>./mycat start</code></p> <p>为了能第一时间看到启动日志，方便定位问题，我们选择①控制台启动。</p> <p><strong>其它操作</strong>：</p> <p>后台关闭：<code>./mycat stop</code></p> <p>后台重启：<code>./mycat restart</code></p> <p>状态： <code>./mycat status</code></p> <p>日志文件：<code>mycat/logs/wrapper.log</code></p> <p><strong>5、启动时可能出现报错</strong></p> <p>如果操作系统是CentOS6.8，可能会出现域名解析失败错误，如下图：</p> <p><img src="https://img-blog.csdnimg.cn/4b57203119954da8b69a45c8c2c8f0bb.jpeg" alt="在这里插入图片描述"></p> <p>可以按照以下步骤解决</p> <p>① 用 <code>vim</code> 修改 <code>/etc/hosts</code> 文件，在 127.0.0.1 后面增加你的机器名</p> <p><img src="https://img-blog.csdnimg.cn/5dbeb2980dd2466aa2f886c455a29a37.jpeg" alt="在这里插入图片描述"></p> <p>② 修改后重新启动网络服务</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service network restart   #CentOS 6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/c6018d13f1ec469988700784ccdeffa5.jpeg" alt="在这里插入图片描述"></p> <h3 id="_3-3-登录"><a href="#_3-3-登录" class="header-anchor">#</a> 3.3 登录</h3> <h4 id="_1-登录后台管理窗口"><a href="#_1-登录后台管理窗口" class="header-anchor">#</a> 1. 登录后台管理窗口</h4> <p><code>9066端口号对应后台管理窗口，用于运维人员管理维护Mycat使用</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql -umycat -p123456 -P 9066 -h 192.168.140.128
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：这里我是在对应MySQL8.0中使用的Mycat，可能会报错：</p> <p><img src="https://img-blog.csdnimg.cn/3b47dcd66a1b4368bb558fb45db91b93.png" alt="在这里插入图片描述"></p> <p>解决方式1：修改server.xml中的标签。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nonePasswordLogin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!-- 0为需要密码登陆、1为不需要密码登陆 ,默认为0，设置为1则需要指定默认账户--&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重新启动mycat无密码登录，访问成功。</p> <p>解决方式2：更换MySQL的版本。</p> <p><strong>常用命令如下</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>show database
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/a6ab4c36b8054fe89d887ce3f61d1c24.png" alt="在这里插入图片描述"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>show @@help
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/92cd23ce147343bdaab7cd726235d025.jpeg" alt="在这里插入图片描述"></p> <h4 id="_2-登录数据窗口"><a href="#_2-登录数据窗口" class="header-anchor">#</a> 2. 登录数据窗口</h4> <p><code>8066端口号对应开发人员使用，用于通过Mycat查询数据</code>，我们选择这种方式访问Mycat</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql -umycat -p123456 -P 8066 -h 192.168.140.128
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>show databases;

use TESTDB;

show tables;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_3-项目中登录"><a href="#_3-项目中登录" class="header-anchor">#</a> 3. 项目中登录</h4> <p>其实项目中，只要改一个地方即可，就是jdbc的连接参数。</p> <p><img src="https://img-blog.csdnimg.cn/34ef31075a464fbcab29e5d3e0b4d0e0.png" alt="在这里插入图片描述"></p> <h2 id="_4-主从复制原理"><a href="#_4-主从复制原理" class="header-anchor">#</a> 4. <a href="https://so.csdn.net/so/search?q=%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">主从复制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>原理</h2> <p>我们通过Mycat和MySQL的主从复制配合搭建数据库的读写分离，实现MySQL的高可用性。我们将搭建：<code>一主一从</code>、<code>双主双从</code>两种读写分离模式。</p> <h3 id="_4-1-主从复制原理"><a href="#_4-1-主从复制原理" class="header-anchor">#</a> 4.1 主从复制原理</h3> <p><img src="https://img-blog.csdnimg.cn/9cc415334ecd4916a96154cfe0d05a09.jpeg" alt="在这里插入图片描述"></p> <p>提到主从同步的原理，我们就需要了解在数据库中的一个重要日志文件，那就是 Binlog 二 进制日志，它记录了对数据库进行更新的事件。实际上主从同步的原理就是基于 Binlog 进行数据同步的。在主从复制过程中，会基于 3 个线程来操作，一个<code>主库线程</code>，两个<code>从库线程</code>。</p> <p>二进制日志转储线程（Binlog dump thread）是一个主库线程。当从库线程连接的时候， 主库可以将二进制日志发送给从库，当主库读取事件的时候，会在 <code>Binlog 上加锁</code>，读取完成之后，再将锁释放掉。</p> <p>从库 I/O 线程会连接到主库，向主库发送请求更新 Binlog。这时从库的 I/O 线程就可以读取到主库的二进制日志转储线程发送的 <code>Binlog 更新部分</code>，并且拷贝到本地形成中继日志 （Relay log）。</p> <p>从库 SQL 线程会读取从库中的中继日志，并且<code>执行日志中的事件</code>，从而将从库中的数据与主库保持<code>同步</code>。</p> <p><img src="https://img-blog.csdnimg.cn/ef30287f1709476b948e13f5f1cd2f44.png" alt="在这里插入图片描述"></p> <p>所以你能看到主从同步的内容就是二进制日志（Binlog），它虽然叫二进制日志，实际上存储的是一个又一个<code>事件（Event）</code>，这些事件分别对应着数据库的更新操作，比如 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code> 等。另外我们还需要注意的是，不是所有版本的 MySQL 都默认开启服务器的二进制日志，在进行主从同步的时候，我们需要先检查服务器<code>是否已经开启了二进制日志</code>。</p> <p>从服务器通过配置可以读取主服务器中二进制日志，并且执行日志中的事件。每个从服务器都能收到整个二进制日志的内容。从服务器需要识别日志中哪些语句应该被执行。除非特殊指定，<code>默认情况下主服务器中所有的事件都将被执行</code>。</p> <h3 id="_4-2-mysql复制三步骤"><a href="#_4-2-mysql复制三步骤" class="header-anchor">#</a> 4.2 MySQL复制三步骤：</h3> <ol><li><code>Master</code>将写操作记录到二进制日志（<code>binlog</code>）。这些记录过程叫做<strong>二进制日志事件</strong>(binary log events)；</li> <li><code>Slave</code>将<code>Master</code>的binary log events拷贝到它的中继日志（<code>relay log</code>）；</li> <li><code>Slave</code>重做中继日志中的事件，将改变应用到自己的数据库中。 MySQL复制是异步的且串行化的，而且重启后从接入点开始复制。</li></ol> <h3 id="_4-3-复制的问题"><a href="#_4-3-复制的问题" class="header-anchor">#</a> 4.3 复制的问题</h3> <p>复制的最大问题：<strong>延时</strong></p> <h3 id="_4-4-复制的基本原则"><a href="#_4-4-复制的基本原则" class="header-anchor">#</a> 4.4 复制的基本原则</h3> <ul><li><p>每个<code>Slave</code>只有一个<code>Master</code></p></li> <li><p>每个<code>Slave</code>只能有一个唯一的服务器ID</p></li> <li><p>每个<code>Master</code>可以有多个<code>Slave</code></p></li></ul> <h2 id="_5-主从复制与读写分离的实现"><a href="#_5-主从复制与读写分离的实现" class="header-anchor">#</a> 5. 主从复制与读写分离的实现</h2> <h3 id="_5-1-搭建主从复制-一主一从"><a href="#_5-1-搭建主从复制-一主一从" class="header-anchor">#</a> 5.1 搭建主从复制：一主一从</h3> <p>一台<code>主机</code>用于处理所有<code>写请求</code>，一台<code>从机</code>负责所有<code>读请求</code>，架构图如下：</p> <p><img src="https://img-blog.csdnimg.cn/7084e7ac752642cd91135833237fed12.png" alt="在这里插入图片描述"></p> <h4 id="_1、搭建mysql主从复制"><a href="#_1、搭建mysql主从复制" class="header-anchor">#</a> 1、搭建MySQL主从复制</h4> <p><strong>① 主机配置(host79)</strong></p> <p>修改配置文件：<code>vim /etc/my.cnf</code></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#主服务器唯一ID
server-id=1

#启用二进制日志
log-bin=mysql-bin

#设置不要复制的数据库(可设置多个)
binlog-ignore-db=mysql
binlog-ignore-db=information_schema

#设置需要复制的数据库。注意：MySQL是从接入点开始复制操作的
binlog-do-db=需要复制的主数据库名字

#设置logbin格式
binlog_format=STATEMENT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>binlog日志三种格式：</p> <ul><li><p><code>STATEMENT模式</code>（基于SQL语句的复制(statement-based replication, SBR)）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>binlog_format=STATEMENT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>每一条会修改数据的sql语句会记录到binlog中。这是默认的binlog格式。</p> <p>优点：binlog文件较小，binlog可以用于实时的还原，而不仅仅用于复制。</p> <p>缺点：使用以下函数的语句也无法被复制：LOAD_FILE()、UUID()、USER()、FOUND_ROWS()、SYSDATE() (除非启动时启用了 --sysdate-is-now 选项)。数据表必须几乎和主服务器保持一致才行，否则可能会导致复制出错。</p></li> <li><p><code>ROW模式</code>（基于行的复制(row-based replication, RBR)）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>binlog_format=ROW
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>不记录每条sql语句的上下文信息，仅需记录哪条数据被修改了，修改成什么样了。</p> <p>优点：任何情况都可以被复制，这对复制来说是最安全可靠的。</p> <p>缺点：binlog 大了很多。无法从 binlog 中看到都复制了写什么语句。</p></li> <li><p><code>MIXED模式</code>（混合模式复制(mixed-based replication, MBR)）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>binlog_format=MIXED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以上两种模式的混合使用。</p></li></ul> <p><img src="https://img-blog.csdnimg.cn/6a2e825091c74e5da303da84834c7028.jpeg" alt="在这里插入图片描述"></p> <p><strong>② 从机配置(host80)</strong></p> <p>修改配置文件：<code>vim /etc/my.cnf</code></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#从服务器唯一ID
server-id=2

#启用中继日志
relay-log=mysql-relay
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>③ 主机、从机重启MySQL服务</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl restart mysqld

systemctl status mysqld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>④ 主机从机都关闭防火墙</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl status firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>⑤ 在Master主机上建立帐户并授权slave</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#在主机MySQL里执行授权主从复制的命令
GRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY '123123';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>注意：如果使用的是MySQL8，需要如下的方式建立账户，并授权slave</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create user 'slave'@'%' identified by 'HelloWorld_123';

GRANT REPLICATION SLAVE ON *.* TO slave@'%';

ALTER USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'HelloWorld_123';

flush privileges;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><strong>查询master的状态</strong></li></ul> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>show master status; #查看当前最新的一个binlog日志的编号名称，及最后一个事件结束的位置
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/c1e030866799410f93b9c8a89445a799.png" alt="在这里插入图片描述"></p> <ul><li>记录下File和Position的值</li></ul> <p>注意：执行完此步骤后不要再操作主服务器MySQL，防止主服务器状态值变化</p> <p><strong>⑥ 在从机上配置需要复制的主机</strong></p> <ul><li>复制主机的命令</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>CHANGE MASTER TO MASTER_HOST='主机的IP地址',
MASTER_USER='slave',
MASTER_PASSWORD='123123',
MASTER_LOG_FILE='mysql-bin.具体数字',MASTER_LOG_POS=具体值;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>举例：
CHANGE MASTER TO MASTER_HOST='192.168.1.110',
MASTER_USER='slave',
MASTER_PASSWORD='HelloWorld_123',
MASTER_LOG_FILE='mysql-bin.000002',MASTER_LOG_POS=1133;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/8a3671cc792941f7aac5a1267683c843.png" alt="在这里插入图片描述"></p> <ul><li><strong>启动从服务器复制功能</strong></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>start slave;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果报错：</p> <p><img src="https://img-blog.csdnimg.cn/f6d5508ea32c4437912af753152119eb.png" alt="在这里插入图片描述"></p> <p>可以执行如下操作，删除之前的relay_log信息。然后重新执行 change master to …语句即可。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql&gt; reset slave;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看从服务器状态</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>show slave status\G;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/4e7e083d1c5d4f69a5c2475ff7b95a27.png" alt="在这里插入图片描述"></p> <p>下面两个参数都是Yes，则说明主从配置成功！</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Slave_IO_Running: Yes
Slave_SQL_Running: Yes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>显式如下的情况，就是不正确的。可能错误的原因有：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 网络不通
2. 账户密码错误
3. 防火墙
4. mysql配置文件问题
5. 连接服务器时语法
6. 主服务器mysql权限
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/f506d7a2dec148639ea6a8b78ecbb550.png" alt="在这里插入图片描述"></p> <p><strong>⑦ 主机新建库、新建表、insert记录，从机复制</strong></p> <p><img src="https://img-blog.csdnimg.cn/e1aff3db4e5448eca8dba01cc336834f.jpeg" alt="在这里插入图片描述"></p> <p>以上就搭建好了<code>主从复制</code>。</p> <p><strong>补充说明1：如何停止从服务复制功能</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>stop slave;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>补充说明2：如何重新配置主从</strong></p> <p>对于从机来说，如果之前搭过主从。会报错如下：</p> <p><img src="https://img-blog.csdnimg.cn/8730f71b7fe2420da9a26c80aa460c56.png" alt="在这里插入图片描述"></p> <p>如何重新配置主从？在从机上执行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>stop slave; 

reset master;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2、mycat登录访问"><a href="#_2、mycat登录访问" class="header-anchor">#</a> 2、Mycat登录访问</h4> <p>（方便起见，可以Xshell中启动三个窗口，针对Mycat所在的服务器进行连接，窗口分别命名为：mycat、bin、conf）</p> <p>启动Mycat，在mycat/bin目录下执行如下命令，启动mycat</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>./mycat console
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>登录mycat账户，并访问数据库中的数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql -umycat -p123456 -h192.168.140.128 -P8066
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>mysql&gt; show database;
mysql&gt; use TESTDB;
mysql&gt; select * from mytbl;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_5-2-实现一主一从的读写分离"><a href="#_5-2-实现一主一从的读写分离" class="header-anchor">#</a> 5.2 实现一主一从的读写分离</h3> <p>之前的配置已分配了读写主机，实现了主从复制，是否已实现读写分离？</p> <h4 id="_1、验证读写分离"><a href="#_1、验证读写分离" class="header-anchor">#</a> 1、验证读写分离</h4> <p>（1）在写主机插入如下数据，这样会出现主从主机数据不一致的情况。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>insert into mytbl values (1,@@hostname);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）在Mycat里查询：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>select * from mytbl; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时发现读取的数据<code>来自于写主机</code>。如果实现了读写分离，那此时应该读取的是从机的数据。说明此时没有实现读写分离。</p> <h4 id="_2、实现读写分离"><a href="#_2、实现读写分离" class="header-anchor">#</a> 2、实现读写分离</h4> <p>修改Mycat的配置文件<code>schema.xml</code>的<code>&lt;dataHost&gt;</code>的balance属性，通过此属性配置读写分离的类型</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>负载均衡类型，目前的取值有4 种：
（1）balance=&quot;0&quot;, 不开启读写分离机制，所有读操作都发送到当前可用的 writeHost 上。

（2）balance=&quot;1&quot;，全部的readHost 与 stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从模式(M1-&gt;S1，M2-&gt;S2，并且 2M1 与 M2 互为主备)，正常情况下，M2,S1,S2 都参与 select 语句的负载均衡。

（3）balance=&quot;2&quot;，所有读操作都随机的在 writeHost、readhost 上分发。

（4）balance=&quot;3&quot;，所有读请求随机的分发到 readhost 执行，writerHost 不负担读压力。对应单主单从。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>读写分离情况下，<code>将balance设置成3是对的</code>。这里为了演示动态效果，把balance设置成2，这样会在两个机器间切换查询。</p> <p>停止mycat服务，修改balance：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>…
&lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;2&quot; writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot; slaveThreshold=&quot;100&quot;&gt;
…
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/6034c34d41524fa3844a49c9234d6027.jpeg" alt="在这里插入图片描述"></p> <h4 id="_3、启动mycat"><a href="#_3、启动mycat" class="header-anchor">#</a> 3、启动Mycat</h4> <h4 id="_4、验证读写分离"><a href="#_4、验证读写分离" class="header-anchor">#</a> 4、验证读写分离</h4> <p>（1）在写主机数据库表mytbl中插入带系统变量数据，造成主从数据不一致</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO mytbl VALUES(2,@@hostname);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/1e6bd677fb694530b1b3b3facce68ee4.jpeg" alt="在这里插入图片描述"></p> <p>（2）在Mycat里查询mytbl表,可以看到查询语句在主从两个主机间切换</p> <p><img src="https://img-blog.csdnimg.cn/df0daa1edc094a7eb69b31a72b5fe1df.png" alt="在这里插入图片描述"></p> <h3 id="_5-3-搭建主从复制-双主双从"><a href="#_5-3-搭建主从复制-双主双从" class="header-anchor">#</a> 5.3 搭建主从复制：双主双从</h3> <p>一个主机m1用于处理所有写请求，它的从机s1和另一台主机m2还有它的从机s2负责所有读请求。当m1主机宕机后，m2主机负责写请求，m1、m2互为备机。架构图如下：</p> <p><img src="https://img-blog.csdnimg.cn/9f063d141e354c93a25209c753306424.png" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/e1b86db260aa4ea69ac20ed819e0f14a.jpeg" alt="在这里插入图片描述"></p> <table><thead><tr><th>编号</th> <th>角色</th> <th>IP地址</th> <th>机器名</th></tr></thead> <tbody><tr><td>1</td> <td>Master1</td> <td>192.168.140.128</td> <td>host79.atguigu</td></tr> <tr><td>2</td> <td>Slave1</td> <td>192.168.140.127</td> <td>host80.atguigu</td></tr> <tr><td>3</td> <td>Master2</td> <td>192.168.140.126</td> <td>host81.atguigu</td></tr> <tr><td>4</td> <td>Slave2</td> <td>192.168.140.125</td> <td>host82.atguigu</td></tr></tbody></table> <h4 id="_1、储备"><a href="#_1、储备" class="header-anchor">#</a> 1、储备</h4> <ul><li><p>记得删除演示一主一从模式时创建的数据库<code>testdb</code>。</p></li> <li><p>记得在之前的从机上执行：<code>stop slave</code> 和 <code>reset master</code> 。</p></li></ul> <h4 id="_2、-搭建mysql主从复制-双主双从"><a href="#_2、-搭建mysql主从复制-双主双从" class="header-anchor">#</a> 2、 搭建MySQL主从复制（双主双从）</h4> <p><strong>① 双主机配置</strong></p> <p><strong>Master1配置</strong>：</p> <p>修改配置文件：<code>vim /etc/my.cnf</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#【必须】主服务器唯一ID
server-id=1

#【必须】启用二进制日志
log-bin=mysql-bin

#设置不要复制的数据库(可设置多个)
binlog-ignore-db=mysql
binlog-ignore-db=information_schema

#【必须】设置需要复制的数据库
binlog-do-db=需要复制的主数据库名字

#设置logbin格式
binlog_format=STATEMENT

#【必须】在作为从数据库的时候，有写入操作也要更新二进制日志文件
log-slave-updates 

#【必须】表示自增长字段每次递增的量，指自增字段的起始值，其默认值是1，取值范围是1 .. 65535
auto-increment-increment=2 

#【必须】表示自增长字段从哪个数开始，指字段一次递增多少，他的取值范围是1 .. 65535
auto-increment-offset=1 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>Master2配置</strong>：</p> <p>修改配置文件：<code>vim /etc/my.cnf</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#【必须】主服务器唯一ID
server-id=3

#【必须】启用二进制日志
log-bin=mysql-bin

#设置不要复制的数据库(可设置多个)
binlog-ignore-db=mysql
binlog-ignore-db=information_schema

#【必须】设置需要复制的数据库
binlog-do-db=需要复制的主数据库名字

#设置logbin格式
binlog_format=STATEMENT

#【必须】在作为从数据库的时候，有写入操作也要更新二进制日志文件
log-slave-updates 

#【必须】表示自增长字段每次递增的量，指自增字段的起始值，其默认值是1，取值范围是1 .. 65535
auto-increment-increment=2 

#【必须】表示自增长字段从哪个数开始，指字段一次递增多少，他的取值范围是1 .. 65535
auto-increment-offset=2

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>② 双从机配置</strong></p> <p><strong>Slave1配置</strong>：</p> <p>修改配置文件：<code>vim /etc/my.cnf</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#【必须】从服务器唯一ID
server-id=2

#【必须】启用中继日志
relay-log=mysql-relay

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Slave2配置</strong>：</p> <p>修改配置文件：<code>vim /etc/my.cnf</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#【必须】从服务器唯一ID
server-id=4

#【必须】启用中继日志
relay-log=mysql-relay

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>③ 双主机、双从机重启mysql服务</strong></p> <p><strong>④ 主机从机都关闭防火墙</strong></p> <p><strong>⑤ 在两台主机上分别建立帐户并授权slave</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#在主机MySQL里执行授权命令
GRANT REPLICATION SLAVE ON *.* TO 'slave'@'%' IDENTIFIED BY '123123';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>注意：如果使用的是MySQL8，需要如下的方式建立账户，并授权slave</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create user 'slave'@'%' identified by 'HelloWorld_123';

GRANT REPLICATION SLAVE ON *.* TO slave@'%';

ALTER USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'HelloWorld_123';

flush privileges;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>查询Master1的状态：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>show master status;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/1d2464c2f9cf4861882faf9e2b49d6b1.png" alt="在这里插入图片描述"></p> <ul><li>查询Master2的状态：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>show master status;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/74fa0108c5954239a14ab359dc1ef576.png" alt="在这里插入图片描述"></p> <p>注意：</p> <p>分别记录下File和Position的值。</p> <p>执行完此步骤后不要再操作主服务器MySQL，防止主服务器状态值变化。</p> <p><strong>⑥ 在从机上配置需要复制的主机</strong></p> <p>Slave1复制Master1，Slave2复制Master2。</p> <p>复制主机的命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CHANGE MASTER TO MASTER_HOST='主机的IP地址',
MASTER_USER='slave',
MASTER_PASSWORD='123123',
MASTER_LOG_FILE='mysql-bin.具体数字',MASTER_LOG_POS=具体值;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>所以，</p> <p>Slave1的复制命令：</p> <p><img src="https://img-blog.csdnimg.cn/80553a7485c14ba1a282b9b3b7f761e9.png" alt="在这里插入图片描述"></p> <p>Slave2的复制命令：</p> <p><img src="https://img-blog.csdnimg.cn/4f193e513a224312bf18b263f6063bd1.png" alt="在这里插入图片描述"></p> <ul><li>启动两台从服务器复制功能</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>start slave;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看从服务器状态</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>show slave status\G;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Slave1的复制Master1</p> <p><img src="https://img-blog.csdnimg.cn/e07de4ade18748d380050f845a92300a.png" alt="在这里插入图片描述"></p> <p>Slave2的复制Master2</p> <p><img src="https://img-blog.csdnimg.cn/328977f632474ea2a6b9ed3de7d658f6.png" alt="在这里插入图片描述"></p> <p>下面两个参数都是Yes，则说明主从配置成功！</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Slave_IO_Running: Yes
Slave_SQL_Running: Yes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>如果当初使用克隆的方式生成的虚拟机（包含MySQL Server），则克隆的虚拟机MySQL Server的UUID相同，必须修改，否则<code>show slave status\G</code>会报错。具体修改方式在 <code>2.使用前准备工作</code></li></ul> <p><strong>⑦ 两个主服务器互相复制</strong></p> <p>Master2复制Master1，Master1复制Master2</p> <p>Master2的复制命令：</p> <p><img src="https://img-blog.csdnimg.cn/5bc0b66f2be24e06b5dfbab913b34444.png" alt="在这里插入图片描述"></p> <p>Master1的复制命令：</p> <p><img src="https://img-blog.csdnimg.cn/4996a3352acb40ff91ab3f75f0bc3425.png" alt="在这里插入图片描述"></p> <ul><li>启动两台主服务器复制功能</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>start slave;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看从服务器状态</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>show slave status\G;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Master2的复制Master1：</p> <p><img src="https://img-blog.csdnimg.cn/159860e94dc4400c930a2c4d373c505b.png" alt="在这里插入图片描述"></p> <p>Master1的复制Master2：</p> <p><img src="https://img-blog.csdnimg.cn/278bd095ae074e788af6b1749e803f24.png" alt="在这里插入图片描述"></p> <p>下面两个参数都是Yes，则说明主从配置成功！</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Slave_IO_Running: Yes
Slave_SQL_Running: Yes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>⑧ Master1主机新建库、新建表、insert记录，Master2和从机复制</p> <p><img src="https://img-blog.csdnimg.cn/9a200ee2bf3a46c6ae01725e1c09d51c.jpeg" alt="在这里插入图片描述"></p> <p>⑨ 如何停止从服务复制功能</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>stop slave;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>⑩ 如何重新配置主从</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>stop slave; 
reset master;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-4-实现双主双从机的读写分离"><a href="#_5-4-实现双主双从机的读写分离" class="header-anchor">#</a> 5.4 实现双主双从机的读写分离</h3> <p>上述操作实现了双主双从的复制，下面实现读写分离操作。</p> <h4 id="_1、修改配置文件"><a href="#_1、修改配置文件" class="header-anchor">#</a> 1、修改配置文件</h4> <p>修改Mycat的配置文件<code>schema.xml</code>的<code>&lt;dataHost&gt;</code>的<code>balance</code>属性，通过此属性配置读写分离的类型</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>负载均衡类型，目前的取值有4 种：
（1）balance=&quot;0&quot;, 不开启读写分离机制，所有读操作都发送到当前可用的 writeHost 上。

（2）balance=&quot;1&quot;，全部的 readHost 与 stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从模式(M1-&gt;S1，M2-&gt;S2，并且 M1 与 M2 互为主备)，正常情况下，M2,S1,S2 都参与 select 语句的负载均衡。

（3）balance=&quot;2&quot;，所有读操作都随机的在 writeHost、readhost 上分发。

（4）balance=&quot;3&quot;，所有读请求随机的分发到 readhost 执行，writerHost 不负担读压力

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>为了双主双从读写分离balance设置为1：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testdb<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>

		<span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- can have multi read hosts --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.127:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--  复制一份 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.126:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- can have multi read hosts --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.125:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
…

#balance=&quot;1&quot;: 全部的readHost与stand by writeHost参与select语句的负载均衡。

#writeType=&quot;0&quot;: 所有写操作发送到配置的第一个writeHost，第一个挂了切到还生存的第二个
#writeType=&quot;1&quot;，所有写操作都随机的发送到配置的 writeHost，1.5 以后废弃不推荐
#writeHost，重新启动后以切换后的为准，切换记录在配置文件中:dnindex.properties 。
#switchType=&quot;1&quot;: 1 默认值，自动切换。
#               -1 表示不自动切换
#                2 基于 MySQL 主从同步的状态决定是否切换。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>主要修改内容见下图红框：</p> <p><img src="https://img-blog.csdnimg.cn/23cd93bdf66a4ba69dbb0ceb5100e238.png" alt="在这里插入图片描述"></p> <h4 id="_2、启动mycat"><a href="#_2、启动mycat" class="header-anchor">#</a> 2、启动Mycat</h4> <h4 id="_3、验证读写分离"><a href="#_3、验证读写分离" class="header-anchor">#</a> 3、验证读写分离</h4> <p>在写主机Master1数据库表mytbl中插入带系统变量数据，造成主从数据不一致</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO mytbl VALUES(3,@@hostname);  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/3b1078bf1b444ce79385d1351cd8a763.jpeg" alt="在这里插入图片描述"></p> <p>在Mycat里查询mytbl表,可以看到查询语句在Master2（host81）、Slave1（host80）、Slave2（host82）主从三个主机间切换。</p> <p><img src="https://img-blog.csdnimg.cn/950c7c567e5a4f7194ca8ca9b7262a9b.png" alt="在这里插入图片描述"></p> <h4 id="_4、抗风险能力测试"><a href="#_4、抗风险能力测试" class="header-anchor">#</a> 4、抗风险能力测试</h4> <p>停止数据库Master1</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl stop mysqld

systemctl status mysqld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/964b39c84f2640ce8fa7c9a61cf0d27c.png" alt="在这里插入图片描述"></p> <p>在Mycat里插入数据依然成功，Master2自动切换为写主机</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO  mytbl VALUES(3,@@hostname);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/89db966c54364d9eaa88ec68b489ab02.png" alt="在这里插入图片描述"></p> <p>启动数据库Master1：</p> <p><img src="https://img-blog.csdnimg.cn/d4d6c38ebcf145828220d2d13d484312.png" alt="在这里插入图片描述"></p> <p>在Mycat里查询mytbl表,可以看到查询语句在Master1（host79）、Slave1（host80）、Slave2（host82）主从三个主机间切换：</p> <p><img src="https://img-blog.csdnimg.cn/61c763a5289c4c3f8bcd9f39d6c4f34b.png" alt="在这里插入图片描述"></p> <p>Master1、Master2互做备机，负责写的主机宕机，备机切换负责写操作，保证数据库读写分离高可用性。</p> <h2 id="_6-mycat数据分片"><a href="#_6-mycat数据分片" class="header-anchor">#</a> 6. Mycat数据分片</h2> <h3 id="_6-1-什么是数据分片"><a href="#_6-1-什么是数据分片" class="header-anchor">#</a> 6.1 什么是数据分片？</h3> <p>简单来说，就是指通过某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面，以达到分散单台设备负载的效果。</p> <h3 id="_6-2-切分模式"><a href="#_6-2-切分模式" class="header-anchor">#</a> 6.2 切分模式</h3> <p>数据的切分（Sharding）根据其切分规则的类型，可以分为两种切分模式：</p> <p><strong>1. 垂直（纵向）切分</strong>：是按照不同的表（或者 Schema）来切分到不同的数据库（主机）之上</p> <p><strong>2. 水平（横向）切分</strong>：是根据表中的数据的逻辑关系，将同一个表中的数据按照某种条件拆分到多台数据库（主机）上面。</p> <h3 id="_6-3-mycat分片原理"><a href="#_6-3-mycat分片原理" class="header-anchor">#</a> 6.3 Mycat分片原理</h3> <p>MyCat的分片实现：</p> <p><img src="https://img-blog.csdnimg.cn/427dcc959094416bb4c1768a10179c42.png" alt="在这里插入图片描述"></p> <p><strong>逻辑库(schema)</strong>：MyCat作为一个数据库中间件，起到一个程序与数据库的桥梁作用。开发人员无需知道MyCat的存在，只需要知道数据库的概念即可。为了让MyCat更透明，它会把自己“伪装”成一个MySQL数据库，因此需要有一个虚拟的 database，在MyCat中也叫逻辑库，英文就是schema。</p> <p><strong>逻辑表（table）</strong>：既然有逻辑库，那么就会有逻辑表，分布式数据库中，对应用来说，读写数据的表就是逻辑表。逻辑表，可以是数据切分后，分布在一个或多个分片库中，也可以不做数据切分，不分片，只有一个表构成。</p> <p><strong>分片节点(dataNode)</strong>：数据切分后，一个大表被分到不同的分片数据库上面，每个表分片所在的数据库就是分片节点（dataNode）。</p> <p><strong>节点主机(dataHost)</strong>：数据切分后，每个分片节点（dataNode）不一定都会独占一台机器，同一机器上面可以有多个分片数据库，这样一个或多个分片节点（dataNode）所在的机器就是节点主机（dataHost）,为了规避单节点主机并发数限制，尽量将读写压力高的分片节点（dataNode）均衡的放在不同的节点主机（dataHost）。</p> <p><strong>分片规则(rule)</strong>：前面讲了数据切分，一个大表被分成若干个分片表，就需要一定的规则，这样按照某种业务规则把数据分到某个分片的规则就是分片规则，数据切分选择合适的分片规则非常重要，将极大的避免后续数据处理的难度。</p> <h2 id="_7-垂直拆分-分库"><a href="#_7-垂直拆分-分库" class="header-anchor">#</a> 7. 垂直拆分——分库</h2> <p>一个数据库由很多表构成，每个表对应着不同的业务，垂直拆分是指按照业务将表进行分类，分布到不同的数据库上面，这样也就将数据或者说压力分担到不同的库上面，如下图：</p> <p><img src="https://img-blog.csdnimg.cn/b28d0e0179a44198a3354027843f2b6a.png" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/f9b065b87c3949759cbefc32a22f87ac.png" alt="在这里插入图片描述"></p> <p>系统被拆分成了：用户、订单交易、支付几个模块。</p> <blockquote><p>【推荐】单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。</p> <p>说明：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。</p> <p>来源：阿里巴巴《Java开发手册》</p></blockquote> <h3 id="_7-1-如何划分表"><a href="#_7-1-如何划分表" class="header-anchor">#</a> 7.1 如何划分表</h3> <p>一个问题：在两台主机上的两个数据库中的表，能否JOIN关联查询？</p> <p>答案：不可以关联查询。</p> <p><strong>分库的原则</strong>：</p> <ol><li><strong>能不切分尽量不要切分</strong>。数据量不是很大的库或者表，尽量不要分片。</li> <li><strong>尽量按照功能模块分库，避免跨库join</strong>。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>#客户表  rows:20万 
CREATE TABLE customer(
    id INT AUTO_INCREMENT,
    NAME VARCHAR(200),
    PRIMARY KEY(id)
);

#订单表   rows:600万
CREATE TABLE orders(
    id INT AUTO_INCREMENT,
    order_type INT,
    customer_id INT,
    amount DECIMAL(10,2),
    PRIMARY KEY(id)  
); 

#订单详细表  rows:600万
CREATE TABLE orders_detail(
    id INT AUTO_INCREMENT,
    detail VARCHAR(2000),
    order_id INT,
    PRIMARY KEY(id)
);

#订单状态字典表   rows:20
CREATE TABLE dict_order_type(
    id INT AUTO_INCREMENT,
    order_type VARCHAR(200),
    PRIMARY KEY(id)
);

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>以上四个表如何分库？客户表分在一个数据库，另外三张都需要关联查询，分在另外一个数据库。</p> <blockquote><p>分布在同一台主机上不同数据库的表，可以进行JOIN查询操作。</p> <p>分布在不同主机上的数据库中的表，不可以进行JOIN查询操作。</p></blockquote> <h3 id="_7-2-实现分库"><a href="#_7-2-实现分库" class="header-anchor">#</a> 7.2 实现分库</h3> <h4 id="_1、修改schema配置文件"><a href="#_1、修改schema配置文件" class="header-anchor">#</a> 1、修改schema配置文件</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TESTDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>

	<span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.127:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123123<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
…
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>主要修改的内容如下图的红框：</p> <p><img src="https://img-blog.csdnimg.cn/7f4fd39f54ee4951b6a0a6cfeea74c64.png" alt="在这里插入图片描述"></p> <h4 id="_2、新增两个空白库"><a href="#_2、新增两个空白库" class="header-anchor">#</a> 2、新增两个空白库</h4> <p>分库操作不是在原来的老数据库上进行操作，需要准备两台机器分别安装新的数据库。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#在数据节点dn1、dn2上分别创建数据库orders
CREATE DATABASE orders;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_3、启动mycat-2"><a href="#_3、启动mycat-2" class="header-anchor">#</a> 3、启动Mycat</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>./mycat console
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/bc3a53d5591e4229983022a1c9e7dd1e.png" alt="在这里插入图片描述"></p> <h4 id="_4、访问mycat进行分库"><a href="#_4、访问mycat进行分库" class="header-anchor">#</a> 4、访问Mycat进行分库</h4> <p>访问Mycat</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql -umycat -p123456 -h 192.168.140.128 -P 8066
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>切换到TESTDB，创建4张表，查看表信息，可以看到成功分库：</p> <p><img src="https://img-blog.csdnimg.cn/b106053a407c4619b8976b56cac56e88.jpeg" alt="在这里插入图片描述"></p> <h2 id="_8-水平拆分-分表"><a href="#_8-水平拆分-分表" class="header-anchor">#</a> 8. 水平拆分——分表</h2> <p>相对于垂直拆分，水平拆分不是将表做分类，而是按照某个字段的某种规则来分散到多个库之中，每个表中包含一部分数据。简单来说，我们可以将数据的水平切分<code>理解为是按照数据行的切分</code>，就是将表中的某些行切分到一个数据库，而另外的某些行又切分到其他的数据库中，如图：</p> <p><img src="https://img-blog.csdnimg.cn/91af03a0019449ffa7a0ff972dd264e5.png" alt="在这里插入图片描述"></p> <h3 id="_8-1-实现分表"><a href="#_8-1-实现分表" class="header-anchor">#</a> 8.1 实现分表</h3> <h4 id="_1、选择要拆分的表"><a href="#_1、选择要拆分的表" class="header-anchor">#</a> 1、选择要拆分的表</h4> <p>MySQL单表存储数据条数是有瓶颈的，单表达到<code>1000万条</code>数据就达到了瓶颈，会影响查询效率，需要进行水平拆分（分表）进行优化。</p> <p>例如：例子中的<code>orders</code>、<code>orders_detail</code>都已经达到600万行数据，需要进行分表优化。</p> <h4 id="_2、分表字段的考量"><a href="#_2、分表字段的考量" class="header-anchor">#</a> 2、分表字段的考量</h4> <p>以<code>orders</code>表为例，可以根据不同字段进行分表。即相同字段值的数据放到同一台主机的表中。</p> <table><thead><tr><th>编号</th> <th>分表字段</th> <th>效果</th></tr></thead> <tbody><tr><td>1</td> <td>id（主键）、创建时间</td> <td>查询订单注重时效，历史订单被查询的次数少，</td></tr> <tr><td>如此分片会造成一个节点访问多，一个访问少，不平均。</td> <td></td> <td></td></tr> <tr><td>2</td> <td>customer_id（客户id）</td> <td>根据客户id去分，两个节点访问平均，一个客户</td></tr> <tr><td>的所有订单都在同一个节点</td> <td></td> <td></td></tr></tbody></table> <h4 id="_3、修改配置文件schema-xml"><a href="#_3、修改配置文件schema-xml" class="header-anchor">#</a> 3、修改配置文件schema.xml</h4> <p>为orders表设置数据节点为dn1、dn2，并指定分片规则为mod_rule（自定义的名字）</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如下图：</p> <p><img src="https://img-blog.csdnimg.cn/d68f5b0d0694470fb9937146b118652d.png" alt="在这里插入图片描述"></p> <h4 id="_4、-修改配置文件rule-xml"><a href="#_4、-修改配置文件rule-xml" class="header-anchor">#</a> 4、 修改配置文件rule.xml</h4> <p>在rule配置文件里新增分片规则<code>mod_rule</code>，并指定规则适用字段为customer_id， 还有选择分片算法mod-long（对字段求模运算），customer_id对两个节点求模，根据结果分片。</p> <p>配置算法<code>mod-long</code>参数count为2，两个节点</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>customer_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>mod-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByMod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- how many data nodes --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如下图：</p> <p><img src="https://img-blog.csdnimg.cn/0157fcbd1d6943029a0becfce25a6509.png" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/2162a6ea979145e28b477fbfb5266b82.png" alt="在这里插入图片描述"></p> <h4 id="_5、在数据节点dn2上建orders表"><a href="#_5、在数据节点dn2上建orders表" class="header-anchor">#</a> 5、在数据节点dn2上建orders表</h4> <p>由于dn1在前面题目中已经创建了orders表，而dn2机器上没有。这里需要执行如下的命令，在dn2上创建orders表：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#订单表   rows:600万
CREATE TABLE orders(
    id INT AUTO_INCREMENT,
    order_type INT,
    customer_id INT,
    amount DECIMAL(10,2),
    PRIMARY KEY(id)  
); 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_6、重启mycat让配置生效"><a href="#_6、重启mycat让配置生效" class="header-anchor">#</a> 6、重启Mycat让配置生效</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>./mycat console
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_7、访问mycat实现分片"><a href="#_7、访问mycat实现分片" class="header-anchor">#</a> 7、访问Mycat实现分片</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>#在mycat里向orders表插入数据，INSERT字段不能省略

INSERT INTO orders(id,order_type,customer_id,amount) VALUES(1,101,100,100100);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(2,101,100,100300);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(3,101,101,120000);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(4,101,101,103000);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(5,102,101,100400);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(6,102,100,100020);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>注意，这里不能使用 INSERT INTO orders VALUES (1,101,100,100100); 语句实现向orders表中插入数据。因为但凡使用mycat实现分表，必须显式指明分表的字段。</p></blockquote> <p>在mycat、dn1、dn2中查看orders表数据，分表成功。</p> <p><img src="https://img-blog.csdnimg.cn/c2f8cc7ba76543fcb301bd311864fd77.jpeg" alt="在这里插入图片描述"></p> <h3 id="_8-2-mycat-的分片-join"><a href="#_8-2-mycat-的分片-join" class="header-anchor">#</a> 8.2 Mycat 的分片 “join”</h3> <p>Orders订单表已经进行分表操作了，和它关联的orders_detail订单详情表如何进行join查询。</p> <p>我们也要对orders_detail进行分片操作。Join的原理如下图：</p> <p><img src="https://img-blog.csdnimg.cn/363e405332dd42d594ef3c57430306bc.jpeg" alt="在这里插入图片描述"></p> <h4 id="_1、er表"><a href="#_1、er表" class="header-anchor">#</a> 1、ER表</h4> <p>Mycat 借鉴了 NewSQL 领域的新秀 Foundation DB 的设计思路，Foundation DB 创新性的提出了 Table Group 的概念，其<strong>将子表的存储位置依赖于主表，并且物理上紧邻存放，因此彻底解决了 JOIN 的效率和性能问题</strong>，根据这一思路，提出了<code>基于 E-R 关系的数据分片</code>策略，子表的记录与所关联的父表记录存放在同一个数据分片上。</p> <p><strong>① 修改schema.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>childTable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">joinKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parentKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
…

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/d08d98fc2dd94b54939da991ac417b25.png" alt="在这里插入图片描述"></p> <p><strong>② 在dn2创建orders_detail表</strong></p> <p>重启Mycat前注意，dn2 上不存在orders_detail表，需要创建此表。语句见上面。</p> <p><strong>③ 重启Mycat</strong></p> <p><strong>④ 访问Mycat向orders_detail表插入数据</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO orders_detail(id,detail,order_id) values(1,'detail1',1);
INSERT INTO orders_detail(id,detail,order_id) VALUES(2,'detail1',2);
INSERT INTO orders_detail(id,detail,order_id) VALUES(3,'detail1',3);
INSERT INTO orders_detail(id,detail,order_id) VALUES(4,'detail1',4);
INSERT INTO orders_detail(id,detail,order_id) VALUES(5,'detail1',5);
INSERT INTO orders_detail(id,detail,order_id) VALUES(6,'detail1',6);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>⑤ 在mycat、dn1、dn2中运行两个表join语句</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Select o.*,od.detail 
from orders o inner join orders_detail od 
on o.id=od.order_id;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/a6ac11e118da4f1eb7e29045ab04e08b.jpeg" alt="在这里插入图片描述"></p> <h4 id="_2、全局表"><a href="#_2、全局表" class="header-anchor">#</a> 2、全局表</h4> <p>在分片的情况下，当业务表因为规模而进行分片以后，<code>业务表</code>与这些附属的<code>字典表</code>之间的关联，就成了比较棘手的问题，考虑到字典表具有以下几个<code>特性</code>：</p> <p>① 变动不频繁</p> <p>② 数据量总体变化不大</p> <p>③ 数据规模不大，很少有超过数十万条记录</p> <p>鉴于此，Mycat 定义了一种特殊的表，称之为“<code>全局表</code>”，全局表具有以下特性：</p> <p>① 全局表的插入、更新操作会实时在所有节点上执行，保持各个分片的数据一致性</p> <p>② 全局表的查询操作，只从一个节点获取</p> <p>③ 全局表可以跟任何一个表进行 JOIN 操作</p> <p>将字典表或者符合字典表特性的一些表定义为全局表，则从另外一个方面，很好的解决了数据 JOIN 的难题。通过<code>全局表 + 基于E-R关系</code>的分片策略，Mycat 可以满足 80%以上的企业应用开发。</p> <p><strong>① 修改schema.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>childTable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">joinKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parentKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dict_order_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>global<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
…

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/05292b45b46c4350aac8e79174479b3b.jpeg" alt="在这里插入图片描述"></p> <p><strong>② 在dn2创建dict_order_type表</strong></p> <p>重启Mycat前注意，dn2 上不存在dict_order_type表，需要创建此表。语句见上面。</p> <p><strong>③ 重启Mycat</strong></p> <p><strong>④ 访问Mycat向dict_order_type表插入数据</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO dict_order_type(id,order_type) VALUES(101,'type1');
INSERT INTO dict_order_type(id,order_type) VALUES(102,'type2');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>⑤ 在Mycat、dn1、dn2中查询表数据</strong></p> <p>在不同机器上查询dict_order_type表中的数据都是完整的。</p> <p><img src="https://img-blog.csdnimg.cn/1bf01b1300e64910a389d4f5ebe6fcdc.jpeg" alt="在这里插入图片描述"></p> <h3 id="_8-3-常用分片规则"><a href="#_8-3-常用分片规则" class="header-anchor">#</a> 8.3 常用分片规则</h3> <h4 id="方式1-取模"><a href="#方式1-取模" class="header-anchor">#</a> 方式1：取模</h4> <p>此规则是对分片字段求模运算。也是水平分表最常用规则。6.1配置分表中，orders表采用了此规则。</p> <h4 id="方式2-分片枚举"><a href="#方式2-分片枚举" class="header-anchor">#</a> 方式2：分片枚举</h4> <p>通过在配置文件中配置可能的枚举id，自己配置分片。本规则适用于特定的场景，比如有些业务需要按照<code>省份</code>或<code>区县</code>来做保存，而全国省份区县固定的，这类业务使用本条规则。</p> <p><strong>（1）修改schema.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 订单归属区域信息表  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_ware_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_intfile<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>（2）修改rule.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_intfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>areacode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>hash-int<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>

…

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hash-int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByFileMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>partition-hash-int.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>

# columns：分片字段，algorithm：分片函数
# mapFile：标识配置文件名称
# type：0为int型、非0为String
#defaultNode：默认节点:小于 0 表示不设置默认节点，大于等于 0 表示设置默认节点，
#             设置默认节点如果碰到不识别的枚举值，就让它路由到默认节点，如不设置不识别就报错
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>（3）修改partition-hash-int.txt配置文件</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">110</span><span class="token punctuation">=</span><span class="token value attr-value">0    # 0 表示第1个数据节点</span>
<span class="token key attr-name">120</span><span class="token punctuation">=</span><span class="token value attr-value">1    # 1 表示第2个数据节点</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>（4）重启Mycat</strong></p> <p><strong>（5）访问Mycat创建表</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#订单归属区域信息表  
CREATE TABLE  orders_ware_info(
    `id`        INT AUTO_INCREMENT comment '编号',
    `order_id`  INT comment '订单编号',
    `address`   VARCHAR(200) comment '地址',
    `areacode`  VARCHAR(20) comment '区域编号',
    PRIMARY KEY(id)
); 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>（6）插入数据</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>INSERT INTO orders_ware_info(id, order_id,address,areacode) VALUES (1,1,'北京','110');
INSERT INTO orders_ware_info(id, order_id,address,areacode) VALUES (2,2,'天津','120');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>（7）查询Mycat、dn1、dn2可以看到数据分片效果</strong></p> <p><img src="https://img-blog.csdnimg.cn/441ff9796f2b4a97b3ae2b66ce4a830e.png" alt="在这里插入图片描述"></p> <h4 id="方式3-范围约定"><a href="#方式3-范围约定" class="header-anchor">#</a> 方式3：范围约定</h4> <p>此分片适用于，提前规划好分片字段某个范围属于哪个分片。</p> <p><strong>（1）修改schema.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 针对支付信息表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>payment_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto_sharding_long<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>（2）修改rule.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto_sharding_long<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>order_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>rang-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rang-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.AutoPartitionByLong<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>autopartition-long.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span> 

# columns：分片字段，algorithm：分片函数
# mapFile：标识配置文件名称
# defaultNode：默认节点:小于 0 表示不设置默认节点，大于等于 0 表示设置默认节点，
#              设置默认节点如果碰到不识别的枚举值，就让它路由到默认节点，如不设置不识别就报错
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>（3）修改autopartition-long.txt配置文件</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>0-102=0
103-200=1 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>（4）重启Mycat</strong><br> <strong>（5）访问Mycat，并创建表</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#支付信息表  
CREATE TABLE  payment_info(
    `id`               INT AUTO_INCREMENT comment '编号',
    `order_id`         INT comment '订单编号',
    `payment_status`   INT comment '支付状态',
    PRIMARY KEY(id)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>（6）插入数据</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>INSERT INTO payment_info (id,order_id,payment_status) VALUES (1,101,0);
INSERT INTO payment_info (id,order_id,payment_status) VALUES (2,102,1);
INSERT INTO payment_info (id,order_id ,payment_status) VALUES (3,103,0);
INSERT INTO payment_info (id,order_id,payment_status) VALUES (4,104,1);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>（7）查询Mycat、dn1、dn2可以看到数据分片效果</strong></p> <p><img src="https://img-blog.csdnimg.cn/1e9722c7ca0f4d2e933def92d8d77d6c.png" alt="在这里插入图片描述"></p> <h4 id="方式4-按日期-天-分片"><a href="#方式4-按日期-天-分片" class="header-anchor">#</a> 方式4：按日期（天）分片</h4> <p>此规则为按天分片。设定时间格式、范围：</p> <p><strong>（1）修改schema.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 针对用户信息表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>login_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_date<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>（2）修改rule.xml配置文件</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>login_date<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>shardingByDate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shardingByDate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dateFormat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>yyyy-MM-dd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sBeginDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2019-01-01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sEndDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2019-01-04<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sPartionDay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span> 

# columns：分片字段，algorithm：分片函数
# dateFormat ：日期格式
# sBeginDate ：开始日期 
# sEndDate：结束日期,则代表数据达到了这个日期的分片后循环从开始分片插入。如果不设定，会报错
# sPartionDay ：分区天数，即默认从开始日期算起，分隔 2 天一个分区
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>（3）重启Mycat</strong><br> <strong>（4）访问Mycat创建表</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#用户信息表  
CREATE TABLE  login_info(
    `id`            INT AUTO_INCREMENT comment '编号',
    `user_id`       INT comment '用户编号',
    `login_date`    date comment '登录日期',
    PRIMARY KEY(id)
); 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>（6）插入数据</strong></p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>INSERT INTO login_info(id,user_id,login_date) VALUES (1,101,'2019-01-01');
INSERT INTO login_info(id,user_id,login_date) VALUES (2,102,'2019-01-02');
INSERT INTO login_info(id,user_id,login_date) VALUES (3,103,'2019-01-03');
INSERT INTO login_info(id,user_id,login_date) VALUES  (4,104,'2019-01-04');
INSERT INTO login_info(id,user_id,login_date) VALUES (5,103,'2019-01-05');
INSERT INTO login_info(id,user_id,login_date) VALUES (6,104,'2019-01-06'); 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>（7）查询Mycat、dn1、dn2可以看到数据分片效果</strong></p> <p><img src="https://img-blog.csdnimg.cn/26d0d5303c8a4b62b71712c926fd7c39.png" alt="在这里插入图片描述"></p> <h3 id="_8-4-全局id序列"><a href="#_8-4-全局id序列" class="header-anchor">#</a> 8.4 全局ID序列</h3> <p><strong>在实现分库分表的情况下，数据库自增主键已无法保证自增主键的全局唯一</strong>。为此，Mycat 提供了<code>全局 sequence</code>，并且提供了包含<code>本地配置</code>和<code>数据库配置</code>等多种实现方式。</p> <h4 id="方式1-本地文件-不推荐"><a href="#方式1-本地文件-不推荐" class="header-anchor">#</a> 方式1：本地文件（不推荐）</h4> <p>此方式 Mycat 将 sequence 配置到文件中，当使用到 sequence 中的配置后，Mycat 会更下 classpath 中的 <code>sequence_conf.properties</code> 文件中 <code>sequence 当前的值</code>。</p> <p>① 优点：本地加载，读取速度较快</p> <p>② 缺点：抗风险能力差，Mycat所在主机宕机后，无法读取本地文件。</p> <h4 id="方式2-数据库方式-推荐"><a href="#方式2-数据库方式-推荐" class="header-anchor">#</a> 方式2：数据库方式（推荐）</h4> <p>利用数据库一个表来进行计数累加，可行。但是每次生成序列都读写数据库，这样效率太低。</p> <p><strong>优化</strong>：Mycat会预加载一部分号段到Mycat的内存中，这样大部分读写序列都是在内存中完成的。</p> <p>如果内存中的号段用完了，Mycat会再向数据库要一次。</p> <blockquote><p><strong>问：那如果Mycat崩溃了 ，那内存中的序列岂不是都没了？</strong></p> <p><strong>答</strong>：是的。如果是这样，那么Mycat启动后会向数据库申请新的号段，原有号段会弃用。</p> <p>也就是说如果Mycat重启，那么损失是当前的号段没用完的号码，但是不会因此出现主键重复。</p></blockquote> <p><strong>① 建库序列脚本</strong></p> <p>在dn1上执行如下操作：(以下脚本来自官方)</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>#在dn1上创建全局序列表
CREATE TABLE MYCAT_SEQUENCE (NAME VARCHAR(50) NOT NULL,current_value INT NOT
NULL,increment INT NOT NULL DEFAULT 100, PRIMARY KEY(NAME)) ENGINE=INNODB;

#创建全局序列所需函数
DELIMITER $$ 
CREATE FUNCTION mycat_seq_currval(seq_name VARCHAR(50)) RETURNS VARCHAR(64)
DETERMINISTIC  
BEGIN
DECLARE retval VARCHAR(64);
SET retval=&quot;-999999999,null&quot;;
SELECT CONCAT(CAST(current_value AS CHAR),&quot;,&quot;,CAST(increment AS CHAR)) INTO retval FROM
MYCAT_SEQUENCE WHERE NAME = seq_name;
RETURN retval;
END $$
DELIMITER ;
 
DELIMITER $$
CREATE FUNCTION mycat_seq_setval(seq_name VARCHAR(50),VALUE INTEGER) RETURNS VARCHAR(64)
DETERMINISTIC
BEGIN
UPDATE MYCAT_SEQUENCE
SET current_value = VALUE
WHERE NAME = seq_name;
RETURN mycat_seq_currval(seq_name);
END $$
DELIMITER ;
 
DELIMITER $$
CREATE FUNCTION mycat_seq_nextval(seq_name VARCHAR(50)) RETURNS VARCHAR(64) 
DETERMINISTIC
BEGIN
UPDATE MYCAT_SEQUENCE
SET current_value = current_value + increment WHERE NAME = seq_name;
RETURN mycat_seq_currval(seq_name);
END $$
DELIMITER ;

#初始化序列表记录
INSERT INTO MYCAT_SEQUENCE(NAME,current_value,increment) 
VALUES ('ORDERS', 400000,100);

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/0e841c4c946e49d48b7a2c81a6f43e6d.png" alt="在这里插入图片描述"></p> <p><strong>② 修改Mycat配置</strong></p> <p><strong>修改sequence_db_conf.properties</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim sequence_db_conf.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>意思是 ORDERS 这个序列在 dn1 这个节点上，具体dn1节点是哪台机子，请参考schema.xml</p> <p><img src="https://img-blog.csdnimg.cn/96f670a2b8c9419e8988598f4fd1de9b.png" alt="在这里插入图片描述"></p> <p><strong>修改server.xml</strong> ：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim server.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>全局序列类型：0-本地文件，1-数据库方式，2-时间戳方式。此处应该修改成1。</p> <p><img src="https://img-blog.csdnimg.cn/926160bff62c4807bf298ee5e31277aa.png" alt="在这里插入图片描述"></p> <p><strong>重启Mycat</strong></p> <p><strong>③ 验证全局序列</strong></p> <p>登录Mycat，插入数据：（可执行多次如下数据）</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>insert into orders(id,amount,customer_id,order_type) values(next value for MYCATSEQ_ORDERS,1000,101,102);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查询数据</p> <p><img src="https://img-blog.csdnimg.cn/a7013e5adbb84f5ca9079c764c0497fa.png" alt="在这里插入图片描述"></p> <p>模拟Mycat宕机（重启Mycat）后，再次Mycat中插入数据，再查询</p> <p><img src="https://img-blog.csdnimg.cn/e959119c935b4bb4b2d88fd9ac8bbae0.png" alt="在这里插入图片描述"></p> <h4 id="方式3-时间戳方式-不推荐"><a href="#方式3-时间戳方式-不推荐" class="header-anchor">#</a> 方式3：时间戳方式（不推荐）</h4> <p>全局序列ID= <code>64 位二进制 (42(毫秒)</code>+<code>5(机器 ID)</code>+<code>5(业务编码)</code>+<code>12(重复累加)</code> 换算成十进制为 18 位数的 long 类型，每毫秒可以并发 12 位二进制的累加。</p> <p>① 优点：配置简单</p> <p>② 缺点：18位ID过长</p> <h4 id="方式4-自主生成全局序列"><a href="#方式4-自主生成全局序列" class="header-anchor">#</a> 方式4：自主生成全局序列</h4> <p>可在<code>Java项目</code>里自己生成全局序列，如下：</p> <p>① 根据业务逻辑组合</p> <p>② 可以利用 redis 的单线程原子性 incr来生成序列</p> <p>③ Twitter的雪花算法</p> <p>但，自主生成需要单独在工程中用Java代码实现，还是推荐使用Mycat自带全局序列。</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/chaos1973/chaos_front/edit/master/docs/03.数据库/02.mysql数据库/01.mysql尚硅谷宋红康/38.第37章【高级篇】补充：MyCat.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/12/16, 10:15:59</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/chaos_front/pages/53f720/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第36章【高级篇】其他数据库日志</div></a> <a href="/chaos_front/pages/33ce2a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第38章【高级篇】主从复制</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/chaos_front/pages/53f720/" class="prev">第36章【高级篇】其他数据库日志</a></span> <span class="next"><a href="/chaos_front/pages/33ce2a/">第38章【高级篇】主从复制</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/chaos_front/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/chaos_front/pages/9542b6/"><div>
            python使用生成器读取大文件-500g
            <!----></div></a> <span class="date">12-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/chaos_front/pages/c12f09/"><div>
            Windows环境下 Docker Desktop 安装 Nginx
            <!----></div></a> <span class="date">04-10</span></dt></dl><dl><dd>03</dd> <dt><a href="/chaos_front/pages/7d7e87/"><div>
            使用nginx部署多个前端项目（三种方式）
            <!----></div></a> <span class="date">04-10</span></dt></dl> <dl><dd></dd> <dt><a href="/chaos_front/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:582862381@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/chaos1973/chaos_front" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>chaos | <a href="https://github.com/chaos1973/chaos_front" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/chaos_front/assets/js/app.a5a7dd88.js" defer></script><script src="/chaos_front/assets/js/3.f64bc0e7.js" defer></script><script src="/chaos_front/assets/js/2.733f61f4.js" defer></script><script src="/chaos_front/assets/js/191.cf629e1b.js" defer></script>
  </body>
</html>
